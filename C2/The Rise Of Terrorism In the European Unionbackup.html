<!DOCTYPE html><head>	<meta charset="utf-8">	<title>The Rise Of Terrorism In the EU</title>	<script src="Scripts/d3.v5.js"></script>	<script src="Scripts/d3.tip.js"></script>	<script src="Scripts/d3.slider.js" ></script>	<script src="Scripts/d3.radarChart.js" charset="utf-8"></script>	<script src="Scripts/d3.seedrandom.js"></script>	<script src="Scripts/d3.layout.cloud.js"></script>	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> <!-- For info icon -->	<div  class="sidenav" id="block_container">		<div id="selectCountry">			<select class="countrySelection" style="width: 230px">				<option value ="European Union" selected>European Union</option>				<option value ="Austria">Austria</option>				<option value ="Belgium">Belgium</option>				<option value ="Bulgaria">Bulgaria</option>				<option value ="Croatia">Croatia</option>				<option value ="Cyprus">Cyprus</option>				<option value ="Czech Republic">Czech Republic</option>				<option value ="Denmark">Denmark</option>				<option value ="Estonia">Estonia</option>				<option value ="Finland">Finland</option>				<option value ="France">France</option>				<option value ="Germany">Germany</option>				<option value ="Greece">Greece</option>				<option value ="Hungary">Hungary</option>				<option value ="Ireland">Ireland</option>				<option value ="Italy">Italy</option>				<option value ="Latvia">Latvia</option>				<option value ="Lithuania">Lithuania</option>				<option value ="Luxembourg">Luxembourg</option>				<option value ="Netherlands">Netherlands</option>				<option value ="Poland">Poland</option>				<option value ="Portugal">Portugal</option>				<option value ="Romania">Romania</option>				<option value ="Slovak Republic">Slovak Republic</option>				<option value ="Slovenia">Slovenia</option>				<option value ="Spain">Spain</option>				<option value ="Sweden">Sweden</option>				<option value ="United Kingdom">United Kingdom</option>			</select>		</div>		<div id="selectTargetType">			<select class="targetTypeSelection" style="width: 230px">				<option value ="No Target Type" selected>No Target Type</option>			</select>		</div>		<div id="selectAttackType">			<select class="attackTypeSelection" style="width: 230px">				<option value ="No Attack Type" selected>No Attack Type</option>			</select>		</div>		<div id="sliderRange"></div>		<div id="clearButton">			<input type="button" class="clearButton" value="Default View">		</div>	</div> 		<div id="block_container2">		<table class="box">		<td><div id="GeoMercator"></div>			<div id="Map">				<div class="tooltip" id="tooltipGeoMap">					<i class="fa fa-info-circle"></i>					<span class="tooltiptext">The Choropleth shows the number of terrorist attacks per country.</span>				</div>			</div>			<div id="geoLegend"></div>		</div></td>		<td><div id="LineChart">			<div class="tooltip" id="tooltipLineChart">				<i class="fa fa-info-circle"></i>				<span class="tooltiptext">The Line Chart shows the evolution of the number of terrorist attacks over the years, as well as the number of successful and international attacks.</span>			</div>			<!-- <div class="checkboxOverall">				<input type="checkbox" class="myCheckbox" value="myCheckbox1" checked="checked" > No. of Attacks				<input type="checkbox" class="myCheckbox" value="myCheckbox2" checked="checked" > No. of Successful Attacks 				<input type="checkbox" class="myCheckbox" value="myCheckbox3" checked="checked" > No. of International Attacks			</div> -->		</div></td>		</div>	</div>	<div id="block_container3">			<tr>			<td ><div id="Treemap">					<div class="tooltip" id="tooltipTree">						<i class="fa fa-info-circle"></i>						<span class="tooltiptext">The Sankey diagram displays the hierarchical relationship between target types and target sub-types, as well as the number of attacks for each type.</span>					</div>				</div>			</td>					<td><div id="BarChart">					<div class="tooltip" id="tooltipBarChart">						<i class="fa fa-info-circle"></i>					<span class="tooltiptext">The Bar Chart displays the hierarchical relationship between target types and target sub-types, as well as the number of attacks for each type.</span>						</div>						</div>				</td>			</tr>		</div>	</table>		<style type="text/css">		.sidenav {		  height: 100%;		  width: 250px;		  position: fixed;		  z-index: 1;		  top: 0;		  left: 0;		  background-color: #6b6c6c;		  overflow-x: hidden;		  padding-top: 20px;		}		.line {			fill: none			stroke: #000		}		.dot {			stroke: #000		}		.fa {		  background-color: #404040; /*grey background*/		  border: none;		  color: #848c83; /*green*/		  font-size: 20px;		  cursor: pointer;		}		table {  			border-collapse: collapse;    	}		td {			border: 2px solid 	#a4a4a3;	    	padding-left: 8px;	    	padding-right: 8px;	    	padding-top: 10px;	    	padding-bottom: 10px;    	}    	select {		   font-family: Times New Roman;		   font-size: 16px;		}    	.box {		    margin-left:250px; /* half of width */		    margin-top:35px; /* half of width */		}		.tooltip {  			font-size: 18px;  			z-index: 1;  			color:#a4a4a3;		}    	#tooltipGeoMap {  			position:absolute;  			left: 300px;  			font-size: 18px;		}		#tooltipLineChart  {  			position:absolute;  			left: 0px;  			top: 6px;  			font-size: 18px;		}		#tooltipTree {  			position:absolute;  			left: 2px;  			top: 0px;  			font-size: 18px;		}		#tooltipBarChart  {  			position:absolute;  			left: 0px;  			top: 0px;  			font-size: 18px;		}		.tooltip .tooltiptext {			visibility: hidden;			background: rgba(0, 0, 0, 0.7);			color: white;			text-align: center;			font-size: 16px;			padding: 4px;			position: absolute;			left: 20px;			width: 300px;  			z-index: 1;		}		.tooltip:hover .tooltiptext {		  visibility: visible;		}	/*	.checkboxOverall {		  	position: relative;		  	width: 530px;		    font-size :16px;		    left: 80px;		    top: 340px;	  	}		.checkboxOverall2 {		  	position: relative;		    font-size :18px;		    left: 170px;		    top: 330px;	  	}*/		#block_container {			/*display: flex;			margin-left:50px;*/	    	justify-content: left;	     	/*padding-top: 10px;	     	height: 63px;*/		}		#selectCountry {			font-size :18px;		    padding-top: 20px;		    padding-left: 14px;		}		#selectVariable {			font-size :18px;		    padding-top: 10px;		    padding-left: 10px;		}		#selectTargetType {			font-size :18px;		    padding-top: 30px;		    padding-left: 14px;		    		}		#selectAttackType {			font-size :18px;		    padding-top: 30px;		    padding-left: 14px;		}		#block_container2 {			display: flex;	    	justify-content: left;		}		#block_container3 {			display: flex;	    	justify-content: left;		}		#GeoMap {		  	position: relative;		    top: 10px;			}		#LineChart {		  	position: relative;		  	top: -10px;		    left: 30px;	  	}		#BubbleChart {		  	position: relative;		  	top: -10px;		    left: 15px;	  	}	  	#BarChart {		  	position: relative;		  	top: 0px;		    left: 30px;	  	}	  	#Treemap {		  	position: relative;		    left: 15px;	  	}		#sliderRange {		    padding-left: 0px;		    padding-top: 20px;		}		#clearButton {			font-size :20px;		    padding-top: 0px;		    padding-left: 20px;		}		.d3-tip table {			background: rgba(0, 0, 0, 0.7);			color: white;			font-size: 17px;			position: r;			padding: 2px;		}		.d3-tip td {			border: none;			padding-left: 4px;	    	padding-right: 4px;	    	padding-top: 4px;	    	padding-bottom: 4px;		}		/*treemap*/		body {		  font-family: "Times New Roman", serif;		  position: relative;		  font-size: 16px;		  background-color: #404040;		}		.node {		  box-sizing: border-box;		  line-height: 1em;		  overflow: hidden;		  position: absolute;		  white-space: pre;		  margin-left: 50px;		}		.node-label,		.node-value {			font-size: 15px;		  color: #000000;		}		.node-value {		  margin-top: -2px;		}		.node-value {		  font-weight: bold;		  font-size: 18px;		}	</style></head><body>	<script type="text/javascript">		var availableYears = [1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,			2012,2013,2014,2015,2016,2017,2018];		var europe = ["Austria","Belgium","Bulgaria","Croatia","Cyprus","Czech Republic", "Denmark", "Estonia", "Finland", "France", "Germany", "Greece", "Hungary", 				    "Ireland", "Italy", "Latvia", "Lithuania", "Luxembourg", "Netherlands", "Poland", "Portugal", "Romania", "Slovak Republic", "Slovenia",				    "Spain", "Sweden", "United Kingdom"];		var attackTypes = ["Assault", "Assassination", "Bombing/Explosion", "Facility/Infrastructure", "Hostage Taking"]		var radarChartColors = ["rgb(89, 161, 79)", "rgb(78, 121, 167)", "rgb(225, 87, 89)", "rgb(242, 142, 44)", "rgb(237, 201, 73)"]	    var geoTicks = [1, 10, 25, 50, 100, 250, 500, 1250, 2500]		var margin = {top: 20, right: 20, bottom: 20, left: 50},		    width = 500 - margin.left - margin.right,		    originalWidth = 520,		    height = 310 - margin.top - margin.bottom,		    originalHeight = 310;		const parseDate = d3.timeParse('%Y');		var selectedCountry = "European Union"		var selectedBoolean = false		var selectCountryTxt = ""		if(selectedCountry == "European Union"){			selectCountryTxt = "EU"		}else{			selectCountryTxt = selectedCountry		}		var selectedTargetType = "No Target Type"		var selectedBooleanTargetType = false		var selectedAttackType = "No Attack Type"		var selectedBooleanAttackType = false		var minYear = parseDate(1990)		var maxYear = parseDate(2018)		var svgGeoMap = d3.select("div#Map")	        .append("svg")	        .attr("width", width + 70)	        .attr("height", height+40)	        .attr("transform", "translate(" + 70 + "," + 0 +")")         	    var geoPath = d3.geoPath();	    var projection = d3.geoMercator()			.scale(385)			.center([0,54])			.translate([width / 2, height / 2])		var mapData = d3.map();		var colorScale = d3.scaleThreshold()		  	.domain(geoTicks)			.range(d3.schemeGreens[9]);		var geoLegend = d3.select("div#geoLegend")	        .append("svg")	        .attr("width", 610)	        .attr("height", 25)	        .attr("transform", "translate(" + 29 + "," + 2 +")")	        .style("color", "#e3eee2")	        .style("font-family", "Times New Roman")	        .style("font-size", 14); 	    var x = d3.scaleLinear()		  	.domain(geoTicks)			.rangeRound([0, 610]);		var color = d3.scaleThreshold()		    .domain(d3.range(1, 11))		    .range(d3.schemeGreens[9]);		geoLegend.selectAll("rect")			.data(color.range().map(function(d) {				d = color.invertExtent(d);				if (d[0] == null) d[0] = x.domain()[0];				if (d[1] == null) d[1] = x.domain()[1];				return d;		    }))			.enter().append("rect")				.attr("height", 8)				.attr("x", function(d) { return x(d[0]); })				.attr("width", function(d) { return x(d[1]) - x(d[0]); })				.attr("fill", function(d) { return color(d[0]); });		geoLegend.call(d3.axisBottom(x)					.tickSize(8)					.tickValues(color.domain())					.tickFormat(function(d,i){ return geoTicks[i] })				)				.select(".domain")   					.remove();		const xScale = d3.scaleTime();		const yScale = d3.scaleLinear();		xScale.range([0, width]);  		yScale.range([height, 0]);  		xScale.domain([minYear, maxYear])		yScale.domain([0, 750+(750*0.25)])		var xAxis = d3.axisBottom()			.scale(xScale)			.tickFormat(d3.timeFormat("%Y"))			.ticks(10);  		const yAxis = d3.axisLeft()			.scale(yScale)			.ticks(10);				var svgLineChart = d3.select("div#LineChart")			.append("svg")			.attr("width", originalWidth + 60)			.attr("height", originalHeight)			.append("g")			.attr("transform", "translate(" + 125 + "," + 5 +")") ;		svgLineChart.append("g")			.attr("class", "xAxis")			.attr("transform", "translate(0, " + height +")")			.call(xAxis)			.style("color", "white")			.style("font-family", "Times New Roman")			.style("font-size", 14);		svgLineChart.append("text")			.attr("id", "xAxis")          			.attr("transform","translate(" + (width/2) + " ," + (height + margin.top + 15) + ")")			.style("text-anchor", "middle")			.style("font-size", "16px")			.style("font-family", "Times New Roman")			.text("Year")			.style("fill", "white");		svgLineChart.append("g")			.attr("class", "yAxis")			.call(yAxis)			.style("color", "white")			.style("font-family", "Times New Roman")			.style("font-size", 14);		svgLineChart.append("text")			.attr("id", "yAxis")          			.attr("transform", "rotate(-90)")			.attr("y", 0 - margin.left - 10)			.attr("x",0 - (height / 2))			.attr("dy", "1em")			.style("text-anchor", "middle")			.style("font-size", "16px")			.style("font-family", "Times New Roman")			.text("Attacks in " + selectCountryTxt)			.style("fill", "white");		var valueline1 = d3.line()			.x(function(d) { return xScale(d.Year);})			.y(function(d) { return yScale(d.totalNumberOfAttacks);})		var valueline2 = d3.line()			.x(function(d) { return xScale(d.Year);})			.y(function(d) { return yScale(d.totalSuccessfulAttacks);})		var valueline3 = d3.line()			.x(function(d) { return xScale(d.Year);})			.y(function(d) { return yScale(d.totalInternationalAttacks);})		var svgBubbleChart = d3.select("div#BubbleChart")			.append("svg")			.attr("width", originalWidth)			.attr("height", originalHeight)			.append("g")			.attr("transform", "translate(" + (margin.left+7) + "," + (5) +")")		svgBubbleChart.append("g")			.attr("class", "xAxis")			.attr("transform", "translate(0, " + height +")")			.call(xAxis)		svgBubbleChart.append("text")			.attr("id", "xAxis")          			.attr("transform","translate(" + (width/2) + " ," + (height + margin.top + 15) + ")")			.style("text-anchor", "middle")			.style("font-size", "11px")			.text("Year")		svgBubbleChart.append("text")			.attr("id", "yAxis")          			.attr("transform", "rotate(-90)")			.attr("y", 0 - margin.left - 10)			.attr("x",0 - (height / 2))			.attr("dy", "1em")			.style("text-anchor", "middle")			.style("font-size", "11px")			.text("Military Expenditure in " + selectedCountry); 		const yScaleExpenditure = d3.scaleLinear();  		yScaleExpenditure.range([height, 0]);		yScaleExpenditure.domain([0, 300000+(300000*0.25)])		const yAxisExpenditure = d3.axisLeft()			.scale(yScaleExpenditure)			.ticks(10)			.tickFormat(function(d) { return(numberFormatter(d)); });					svgBubbleChart.append("g")			.attr("class", "yAxisExpenditure")			.call(yAxisExpenditure)			/*barc chart variables start*/	    const marginBar = 100;	    const widthBar = 480 - 2 * marginBar;	    const heightBar = 650 - 2 * marginBar;	    var svgBar = d3.select("div#BarChart")			.append("svg")			.attr("width", originalWidth+200)			.attr("height", originalHeight + 30)			.append("g")	    	.attr('transform', `translate(${marginBar + 45}, ${marginBar-85})`);		    		 var colorBar = d3.scaleLinear()		    .domain([0, 300,500, 1000, 1500, 3000 ,5000])  		    .range(["#c7e9c0", "#a1d99b", "#74c476", "#41ab5d", "#238b45", "#006d2c", "#00441b"]); /*verdes*/		    /*barc chart variables end*/       	/*Treemap Diagram*/       	var marginTree = {top: 10, right: 0, bottom: 10, left: 95},			  widthTree = 265 - marginTree.left - marginTree.right,			  heightTree = 320 - marginTree.top - marginTree.bottom;		var svgTree = d3.select("div#Treemap")			.append('svg')			.attr("width", width)	        .attr("height", heightTree + 15)			.append("g")       	var nestTree = d3.nest()		    .key(function(d) { return d.targetType; })		    .key(function(d) { return d.targetSubtype; })		    .rollup(function(d) { return d3.sum(d, function(d) { return d.numberOfAttacks; }); });		var treemap = d3.treemap()		    .size([widthTree, heightTree])		    .padding(1)		    .round(true);		 var colorTree = d3.scaleLinear()		    .domain([0,50, 100, 200, 400, 800 ,1200])  		    .range(["#e5f5e0", "#c7e9c0", "#a1d99b", "#74c476", "#41ab5d", "#238b45", "#006d2c"]); /*verdes*/       	/*Treemap end*/		var zScale = d3.scaleLinear();		var wScale = d3.scaleLinear();		var vScale = d3.scaleLinear();		var lineChartLegend = null		var bubbleChartLegend = null		var colors = null		var colors2 = null		var tip1 = d3.tip()		var tip2 = d3.tip()		var tip3 = d3.tip()		var tip4 = d3.tip()		var tip5 = d3.tip()		var tip6 = d3.tip()		var tip7 = d3.tip()		var tip8 = d3.tip()//tree		var tip9 = d3.tip()		var tip10 = d3.tip()		var sumAttacks = new Array();		var sumSuccessfulAttacks = new Array();		var sumInternationalAttacks = new Array();		var sumExpenditureValue = new Array();		var radarData = new Array();		var sliderRange;		savedAttacksDataset = null;		savedExpenditureDataset = null;		d3.csv("Data/GlobalTerrorismCleaned.csv", function(d) {		    return {		    	country: (d.country).trim(),				Year: parseDate(d.Year),				success: parseInt(d.success),				internationalAttack: parseInt(d.internationalAttack),				attackType: (d.attackType).trim(),				targetType: (d.targetType).trim(),				targetSubtype: (d.targetSubtype).trim(),				terroristGroup: (d.terroristGroup).trim(),				numberKilled: parseInt(d.numberKilled),				numberWounded: parseInt(d.numberWounded)		    };  			}).then(function(data) {		    	for(i =0 ; i < data.length; i++){					if(data[i].targetType.trim() == data[i].targetSubtype.trim()){						data[i].targetSubtype = (data[i].targetSubtype).trim() + " Institutions"					}					if((data[i].targetType.trim()!="Politician") && (data[i].targetSubtype.trim()=="Politician")){						data[i].targetType = "Government"						data[i].targetSubtype = "Government Institutions"					}				}									//createCheckboxes(data);				createSlider(data);				createSelection(data);				createClearButton(data);				createlineChartLegend();				createbubbleChartLegend();				createToolTips();				readDataToFillMap(data);				readGeoJson(data);				readDataBarChart(data);				readDataTreemap(data);				joinAttacksDatasetWithExpenditureDatasetForCreation(data);   		});		function readDataToFillMap(attacksDataset){			var years = d3.range(minYear.getFullYear(), maxYear.getFullYear() + 1)			attacksFromThatYear = attacksDataset.filter(function (d){				return (years.includes(d.Year.getFullYear()));			});			if(selectedAttackType != "No Attack Type"){				attacksFromThatYear = attacksFromThatYear.filter(function (d){					return ((d.attackType == selectedAttackType));				});			}			if(selectedTargetType != "No Target Type"){				attacksFromThatYearAux = attacksFromThatYear.filter(function (d){					return ((d.targetType == selectedTargetType));				});				if(attacksFromThatYearAux.length == 0){					attacksFromThatYear = attacksFromThatYear.filter(function (d){						return ((d.targetSubtype == selectedTargetType));					});				} else {					attacksFromThatYear = attacksFromThatYearAux;				}			}		    for(i =0 ; i < europe.length; i++){			    attacksFromThatCountry = attacksFromThatYear.filter(function (d){					return (d.country == europe[i]);				});				totalValue = attacksFromThatCountry.length				mapData.set(europe[i], totalValue)			}		}		function readGeoJson(attacksDataset){			d3.json("Data/world.geojson").then(data => {				let mouseOver = function(d) {					if(europe.includes(d3.select(this).attr("id")) || d3.select(this).attr("id")=="UnitedKingdom" || d3.select(this).attr("id")=="CzechRepublic" || d3.select(this).attr("id")=="SlovakRepublic"){						d3.selectAll(".Country")							.filter(function() {								auxId = this.id								if(this.id == "UnitedKingdom"){							   		auxId = "United Kingdom"							   	}else if(this.id == "CzechRepublic"){							   		auxId = "Czech Republic"								}else if(this.id == "SlovakRepublic"){									auxId = "Slovak Republic"						   		}							    return auxId != selectedCountry							})							.transition()							.duration(100)							.style("opacity", 0.5)				    	d3.select(this)							.transition()							.duration(100)							.style("opacity", 1)					}				}				let mouseLeave = function(d) {					if(selectedCountry=="European Union"){						d3.selectAll(".Country")							.transition()							.duration(100)							.style("opacity", 1)					}				    d3.select(this)						.transition()						.duration(100)						.style("opacity", 1)				}				let click = function(d) {					if(europe.includes(d3.select(this).attr("id")) || d3.select(this).attr("id")=="UnitedKingdom" || d3.select(this).attr("id")=="CzechRepublic" || d3.select(this).attr("id")=="SlovakRepublic"){					  	if(selectedBoolean == false){					  		d3.selectAll(".Country").style("opacity", .5)							d3.select(this).style("stroke-width", 1.4)							d3.select(this).style("opacity", 1)						    selectedBoolean = true;						    if(d3.select(this).attr("id") == "UnitedKingdom"){						   		selectedCountry = "United Kingdom"						   	}else if(d3.select(this).attr("id") == "CzechRepublic"){						   		selectedCountry = "Czech Republic"							}else if(d3.select(this).attr("id") == "SlovakRepublic"){								selectedCountry = "Slovak Republic"						    } else {						    	selectedCountry = d3.select(this).attr("id")						    }						    d3.select(".countrySelection").property('value', selectedCountry)							d3.select(".countrySelection").dispatch("change")						} else {							if(d3.select(this).attr("id")==selectedCountry || (d3.select(this).attr("id")=="UnitedKingdom" && selectedCountry=="United Kingdom")  								|| (d3.select(this).attr("id")=="CzechRepublic" && selectedCountry=="Czech Republic") 								|| (d3.select(this).attr("id")=="SlovakRepublic" && selectedCountry=="Slovak Republic")){								d3.selectAll(".Country").style("opacity", 1)								d3.select(this).style("stroke-width", 0.4)							    selectedBoolean = false;							    d3.select(".countrySelection").property('value', "European Union")								d3.select(".countrySelection").dispatch("change")							} else {								d3.selectAll(".Country").style("opacity", .5)								d3.select(this).style("stroke-width", 1.4)								d3.select(this).style("opacity", 1)							    selectedBoolean = true;							    if(d3.select(this).attr("id") == "UnitedKingdom"){							   		selectedCountry = "United Kingdom"							   	}else if(d3.select(this).attr("id") == "CzechRepublic"){							   		selectedCountry = "Czech Republic"								}else if(d3.select(this).attr("id") == "SlovakRepublic"){									selectedCountry = "Slovak Republic"							    } else {							    	selectedCountry = d3.select(this).attr("id")						  	  	}						  	  	selectedBoolean = true;						  	  	d3.select(".countrySelection").property('value', selectedCountry)								d3.select(".countrySelection").dispatch("change")							} 						}					}				}			   	svgGeoMap.append("g")					.selectAll("path")					.data(data.features)					.enter()					.append("path")						.attr("class", function(d){ return "Country" } )						.attr("id", function(d){ return (d.properties.name).replace(/\s/g, ""); } )						.attr("d", d3.geoPath()							.projection(projection)						)						.attr("fill", function (d) {							if(europe.includes(d.properties.name)){								d.total = mapData.get(d.properties.name) || 0;								return colorScale(d.total);							} else {								return "#f7f7f7";							}												})						.style("stroke", "black")						.style("stroke-width", "0.4")						.style("opacity", 1)						.on("mouseover", mouseOver)			  			.on("mouseleave", mouseLeave)			  			.on("click", click)			  			.on('mouseover.tip', tip4.show)						.on('mouseout.tip', tip4.hide)			});		}		function updateGeoJson(attacksDataset){			readDataToFillMap(attacksDataset)		    svgGeoMap.selectAll("path")		    	.attr('fill', function(d) {			    	if(europe.includes(d.properties.name)){						d.total = mapData.get(d.properties.name) || 0;						return colorScale(d.total);					} else {						return "#f7f7f7";					} 			 	});		}		function joinAttacksDatasetWithExpenditureDatasetForCreation(attacksDateset){  			d3.csv("Data/EUMilitaryExpenditureCleaned.csv", function(d) {			    return {			    	country: (d.country).trim(),					Year: parseDate(d.year),					militaryExpenditure: parseInt(d.value)			    };  			}).then(function(expenditureDataset) {  				readDataset(attacksDateset, expenditureDataset);				createNumberOfAttacks();				createNumberOfSuccessfulAttacks();				createNumberOfInternationalAttacks();				createSortedBubbleChart(true, true);							savedAttacksDataset = attacksDateset;				savedExpenditureDataset = expenditureDataset;			})  		}		function readDataset(attacksDataset, expenditureDataset){			sumAttacks = new Array();			sumSuccessfulAttacks = new Array();			sumInternationalAttacks = new Array();			sumExpenditureValue = new Array();			var years = d3.range(minYear.getFullYear(), maxYear.getFullYear() + 1)			for (var i in years) {				const year = years[i]				var attacksFromThatYear = null				var attacksFromThatYearForExpenditure = null				if(selectedCountry == "European Union"){					attacksFromThatYear = attacksDataset.filter(function (d){						return (d.Year.getFullYear() == year);					});					attacksFromThatYearForExpenditure = expenditureDataset.filter(function (d){						return (d.Year.getFullYear() == year);					});				}else{					attacksFromThatYear = attacksDataset.filter(function (d){						return ((d.Year.getFullYear() == year) && (d.country === selectedCountry.trim()));					});					attacksFromThatYearForExpenditure = expenditureDataset.filter(function (d){						return ((d.Year.getFullYear() == year) && (d.country === selectedCountry.trim()));					});				}				if(selectedAttackType != "No Attack Type"){					attacksFromThatYear = attacksFromThatYear.filter(function (d){						return ((d.attackType == selectedAttackType));					});				}				if(selectedTargetType != "No Target Type"){					attacksFromThatYearAux = attacksFromThatYear.filter(function (d){						return ((d.targetType == selectedTargetType));					});					if(attacksFromThatYearAux.length == 0){						attacksFromThatYear = attacksFromThatYear.filter(function (d){							return ((d.targetSubtype == selectedTargetType));						});					} else {						attacksFromThatYear = attacksFromThatYearAux;					}				}				sumAttacks.push({					Year: parseDate(year),					totalNumberOfAttacks: attacksFromThatYear.length				})				sumSuccessfulAttacks.push({					Year: parseDate(year),					totalSuccessfulAttacks: d3.sum(attacksFromThatYear, d => d.success)				})				sumInternationalAttacks.push({					Year: parseDate(year),					totalInternationalAttacks: d3.sum(attacksFromThatYear, d => d.internationalAttack)				})				sumExpenditureValue.push({					Year: parseDate(year),					totalNumberOfAttacks: attacksFromThatYear.length,					totalNumberKilled: d3.sum(attacksFromThatYear, d => d.numberKilled),					totalNumberWounded: d3.sum(attacksFromThatYear, d => d.numberWounded),					totalExpenditure: d3.sum(attacksFromThatYearForExpenditure, d => d.militaryExpenditure)				})			}			xScale.domain([minYear, maxYear])			var tickNumber = (maxYear.getFullYear()-minYear.getFullYear()) + 1			if(tickNumber < 10){				xAxis.ticks(tickNumber);			}			d3.selectAll("g").selectAll(".xAxis")   				.call(xAxis);			var maxsumAttacks = d3.max(sumAttacks, d => d.totalNumberOfAttacks)			yScale.domain([0, maxsumAttacks+(maxsumAttacks*0.25)])			d3.selectAll("g").selectAll(".yAxis")   				.call(yAxis);   			var maxsumExpenditure = d3.max(sumExpenditureValue, d => d.totalExpenditure)   			var minsumExpenditure = d3.min(sumExpenditureValue, d => d.totalExpenditure)			yScaleExpenditure.domain([(minsumExpenditure-(minsumExpenditure*0.20)), maxsumExpenditure+(maxsumExpenditure*0.20)])			d3.selectAll("g").selectAll(".yAxisExpenditure")   				.call(yAxisExpenditure);			zScale.domain([0, maxsumAttacks])			zScale.range([1, 20]);			var maxsumKilled = d3.max(sumExpenditureValue, d => d.totalNumberKilled)			wScale.domain([0, maxsumKilled])			wScale.range([1, 20]);			var maxsumWounded = d3.max(sumExpenditureValue, d => d.totalNumberWounded)			vScale.domain([0, maxsumWounded])			vScale.range([1, 20]);		}								function createlineChartLegend(){			lineChartLegend = svgLineChart.append("g")						.attr("class", "lineChartLegend")						.attr("transform", `translate(300, 5)`)						.style("font-size", "11px");		}		function updatelineChartLegend(){			if(lineChartLegend != null){				lineChartLegend.remove()			}			createlineChartLegend();			Object.keys(colors).forEach((color, i) => {				lineChartLegend					.append("text")					.attr("fill", "white")					.attr("y", `${i}em`)					.attr("x", "1em")					.text(colors[color].name);				lineChartLegend					.append("circle")					.attr("cy", `${i - 0.25}em`)					.attr("cx", 0)					.attr("r", "0.4em")					.attr("fill", colors[color].hex);			});		}		function createToolTips(){			tip1 = d3.tip()					.attr('class', 'd3-tip')					.offset([-5, 0])					.html(function (d) {						var content = "<table style=\"margin-top: 1px;\"><tr><td>" + d.Year.getFullYear() +						    " : </td><td style=\"text-align: center\">" + d.totalNumberOfAttacks + "</td></tr></table>"						return content;		    		});	    	svgLineChart.call(tip1);	    	tip2 = d3.tip()					.attr('class', 'd3-tip')					.offset([-5, 0])					.html(function (d) {						var content = "<table style=\"margin-top: 1px;\"><tr><td>" + d.Year.getFullYear() +						    " : </td><td style=\"text-align: center\">" + d.totalSuccessfulAttacks + "</td></tr></table>"						return content;		    		});		    svgLineChart.call(tip2);			tip3 = d3.tip()					.attr('class', 'd3-tip')					.offset([-5, 0])					.html(function (d) {						var content = "<table style=\"margin-top: 1px;\"><tr><td>" + d.Year.getFullYear() +						    " : </td><td style=\"text-align: center\">" + d.totalInternationalAttacks + "</td></tr></table>"						return content;		   			});	    	svgLineChart.call(tip3);	    	tip4 = d3.tip()		        .attr('class', 'd3-tip')		        .offset([-5, 0])		        .html(function (d) {		        	if(europe.includes(d.properties.name) || d.properties.name=="UnitedKingdom" || d.properties.name=="CzechRepublic" || d.properties.name=="SlovakRepublic"){						var content = "<table style=\"margin-top: 1px;\"><tr><td>" + d.properties.name +						    " : </td><td style=\"text-align: center\">" + d.total + "</td></tr></table>"						return content;					}		   		});	    	svgGeoMap.call(tip4);	    	tip7 = d3.tip()		        .attr('class', 'd3-tip')		        .offset([-5, 0])		        .html(function (d) {		        	var content = "<table style=\"margin-top: 1px;\"><tr><td>" + "Total Attacks" +						" : </td><td style=\"text-align: center\">" + d.totalAttacks + "</td></tr></table>"					return content;		   		});	    	svgBar.call(tip7);	    	tip8 = d3.tip()		        .attr('class', 'd3-tip')		        .offset([-5, 0])		        .html(function (d) {		        	var content = "<table style=\"margin-top: 1px;\"><tr><td>" + "Total Attacks" +						" : </td><td style=\"text-align: center\">" + d.data.value + "</td></tr></table>"					return content;		   		});	    	svgTree.call(tip8);		}		function numberFormatter(num) {			if (num >= 1000000000) {				return (num / 1000000000).toFixed(1).replace(/\.0$/, '') + 'G';			}			if (num >= 1000000) {				return (num / 1000000).toFixed(1).replace(/\.0$/, '') + 'M';			}			if (num >= 1000) {				return (num / 1000).toFixed(1).replace(/\.0$/, '') + 'K';			}				return num;			}		function createBubbleChartToopltip(year, totalExpenditure, totalNumberKilled){			tip5 = d3.tip()				.attr('class', 'd3-tip')				.offset([-5, 0])				.html(function (d) {					var content = "<table style=\"margin-top: 1px;\"><tr><td>" + year.getFullYear() +					    " : </td><td>" + numberFormatter(totalExpenditure) + " : </td><td style=\"text-align: center\">" + totalNumberKilled + "</td></tr></table>"					return content;	    		});		    svgLineChart.call(tip5);		}		function createBubbleChartToopltip2(year, totalExpenditure, totalNumberWounded){			tip6 = d3.tip()				.attr('class', 'd3-tip')				.offset([-5, 0])				.html(function (d) {					var content = "<table style=\"margin-top: 1.5px;\"><tr><td>" + year.getFullYear() +					    " : </td><td>" + numberFormatter(totalExpenditure) + " : </td><td style=\"text-align: center\">" + totalNumberWounded + "</td></tr></table>"					return content;	    		});		    svgLineChart.call(tip6);		}		function createNumberOfAttacks(){			svgLineChart.selectAll(".circleNumberOfAttacks")				.data(sumAttacks)				.enter()				.append("circle")		        	.attr("class","circleNumberOfAttacks")			        .style("fill", "transparent")			        .attr("r", "8")			        .attr("opacity", "1")		            .attr("cx", function(d) { return xScale(d.Year); })		            .attr("cy", function(d) { return yScale(d.totalNumberOfAttacks); })		            .on("mouseover", function(d){		            	d3.selectAll(".circleNumberOfSuccessfulAttacks").style("opacity", "0.4");		            	d3.selectAll(".lineNumberOfSuccessfulAttacks").style("opacity", "0.3");		            	d3.selectAll(".circleNumberOfInternationalAttacks").style("opacity", "0.4");		            	d3.selectAll(".lineNumberOfInternationalAttacks").style("opacity", "0.3");						d3.select(this).attr("r", "6").style("fill", "#fc9e4f");					}).on("mouseout", function(d){						d3.selectAll(".circleNumberOfSuccessfulAttacks").style("opacity", "1");		            	d3.selectAll(".lineNumberOfSuccessfulAttacks").style("opacity", "1");		            	d3.selectAll(".circleNumberOfInternationalAttacks").style("opacity", "1");		            	d3.selectAll(".lineNumberOfInternationalAttacks").style("opacity", "1");						d3.select(this).attr("r", "8").style("fill", "transparent");					})					.on('mouseover.tip', tip1.show)					.on('mouseout.tip', tip1.hide)				    			svgLineChart.append("path")				.attr("class","lineNumberOfAttacks")				.attr("fill", "none")				.attr("stroke", "#fc9e4f")				.attr("stroke-width", 2)			 	.attr("opacity", "1")				.attr("d", valueline1(sumAttacks))				.on("mouseover", function(d){					d3.selectAll(".circleNumberOfSuccessfulAttacks").style("opacity", "0.4");	            	d3.selectAll(".lineNumberOfSuccessfulAttacks").style("opacity", "0.3");	            	d3.selectAll(".circleNumberOfInternationalAttacks").style("opacity", "0.4");	            	d3.selectAll(".lineNumberOfInternationalAttacks").style("opacity", "0.3");				}).on("mouseout", function(d){					d3.selectAll(".circleNumberOfSuccessfulAttacks").style("opacity", "1");	            	d3.selectAll(".lineNumberOfSuccessfulAttacks").style("opacity", "1");	            	d3.selectAll(".circleNumberOfInternationalAttacks").style("opacity", "1");	        	   	d3.selectAll(".lineNumberOfInternationalAttacks").style("opacity", "1");				})			var colorsAux = {				NumberOfAttacks: {				    hex: "#fc9e4f",				    name: "Total Attacks"				}			};			if(colors != null){				Object.assign(colors,colorsAux);			} else {				colors = colorsAux			}			updatelineChartLegend();		}		function createNumberOfSuccessfulAttacks(){			svgLineChart.selectAll(".circleNumberOfSuccessfulAttacks")				.data(sumSuccessfulAttacks)				.enter()				.append("circle")		        	.attr("class","circleNumberOfSuccessfulAttacks")			        .attr("fill", "transparent")			        .attr("r", "8")			        .attr("opacity", "1")		            .attr("cx", function(d) { return xScale(d.Year); })		            .attr("cy", function(d) { return yScale(d.totalSuccessfulAttacks); })		            .on("mouseover", function(d){						d3.selectAll(".circleNumberOfAttacks").style("opacity", "0.4");		            	d3.selectAll(".lineNumberOfAttacks").style("opacity", "0.3");		            	d3.selectAll(".circleNumberOfInternationalAttacks").style("opacity", "0.4");		            	d3.selectAll(".lineNumberOfInternationalAttacks").style("opacity", "0.3");						d3.select(this).attr("r", "6").attr("fill", "#fcc84f");					}).on("mouseout", function(d){						d3.selectAll(".circleNumberOfAttacks").style("opacity", "1");		            	d3.selectAll(".lineNumberOfAttacks").style("opacity", "1");		            	d3.selectAll(".circleNumberOfInternationalAttacks").style("opacity", "1");		            	d3.selectAll(".lineNumberOfInternationalAttacks").style("opacity", "1");		            	d3.select(this).attr("r", "8").attr("fill", "transparent");					})					.on('mouseover.tip', tip2.show)					.on('mouseout.tip', tip2.hide)				    			svgLineChart.append("path")				.attr("class","lineNumberOfSuccessfulAttacks")				.attr("fill", "none")				.attr("stroke", "#fcc84f")				.attr("stroke-width", 2)				.attr("opacity", "1")				.attr("d", valueline2(sumSuccessfulAttacks))				.on("mouseover", function(d){					d3.selectAll(".circleNumberOfAttacks").style("opacity", "0.4");	            	d3.selectAll(".lineNumberOfAttacks").style("opacity", "0.3");	            	d3.selectAll(".circleNumberOfInternationalAttacks").style("opacity", "0.4");	            	d3.selectAll(".lineNumberOfInternationalAttacks").style("opacity", "0.3");				}).on("mouseout", function(d){					d3.selectAll(".circleNumberOfAttacks").style("opacity", "1");	            	d3.selectAll(".lineNumberOfAttacks").style("opacity", "1");	            	d3.selectAll(".circleNumberOfInternationalAttacks").style("opacity", "1");	            	d3.selectAll(".lineNumberOfInternationalAttacks").style("opacity", "1");				})			var colorsAux = {				NumberOfSuccessfulAttacks: {				    hex: "#fcc84f",				    name: "Successful Attacks"				}			};			if(colors != null){				Object.assign(colors,colorsAux);			} else {				colors = colorsAux			}			updatelineChartLegend();		}		function createNumberOfInternationalAttacks(){			svgLineChart.selectAll(".circleNumberOfInternationalAttacks")				.data(sumInternationalAttacks)				.enter()				.append("circle")		        	.attr("class","circleNumberOfInternationalAttacks")			        .attr("fill", "transparent")			        .attr("r", "8")			        .attr("opacity", "1")		            .attr("cx", function(d) { return xScale(d.Year); })		            .attr("cy", function(d) { return yScale(d.totalInternationalAttacks); })		            .on("mouseover", function(d){						d3.selectAll(".circleNumberOfAttacks").style("opacity", "0.4");		            	d3.selectAll(".lineNumberOfAttacks").style("opacity", "0.3");		            	d3.selectAll(".circleNumberOfSuccessfulAttacks").style("opacity", "0.4");		            	d3.selectAll(".lineNumberOfSuccessfulAttacks").style("opacity", "0.3");						d3.select(this).attr("r", "6").attr("fill", "#fc724f");					}).on("mouseout", function(d){						d3.selectAll(".circleNumberOfAttacks").style("opacity", "1");		            	d3.selectAll(".lineNumberOfAttacks").style("opacity", "1");		            	d3.selectAll(".circleNumberOfSuccessfulAttacks").style("opacity", "1");		            	d3.selectAll(".lineNumberOfSuccessfulAttacks").style("opacity", "1");		            	d3.select(this).attr("r", "8").attr("fill", "transparent");					})					.on('mouseover.tip', tip3.show)					.on('mouseout.tip', tip3.hide)				    			svgLineChart.append("path")				.attr("class","lineNumberOfInternationalAttacks")				.attr("fill", "none")				.attr("stroke", "#fc724f")				.attr("stroke-width", 2)				.attr("opacity", "1")				.attr("d", valueline3(sumInternationalAttacks))				.on("mouseover", function(d){					d3.selectAll(".circleNumberOfAttacks").style("opacity", "0.4");	            	d3.selectAll(".lineNumberOfAttacks").style("opacity", "0.3");	            	d3.selectAll(".circleNumberOfSuccessfulAttacks").style("opacity", "0.4");	            	d3.selectAll(".lineNumberOfSuccessfulAttacks").style("opacity", "0.3");					}).on("mouseout", function(d){					d3.selectAll(".circleNumberOfAttacks").style("opacity", "1");	            	d3.selectAll(".lineNumberOfAttacks").style("opacity", "1");	            	d3.selectAll(".circleNumberOfSuccessfulAttacks").style("opacity", "1");	            	d3.selectAll(".lineNumberOfSuccessfulAttacks").style("opacity", "1");				})			var colorsAux = {				NumberOfInternationalAttacks: {				    hex: "#fc724f",				    name: "International Attacks"				}			};			if(colors != null){				Object.assign(colors,colorsAux);			} else {				colors = colorsAux			}			updatelineChartLegend();		}		function createbubbleChartLegend(){			bubbleChartLegend = svgBubbleChart.append("g")				.attr("class", "bubbleChartLegend")				.attr("transform", `translate(340, 5)`)				.style("font-size", "11px");		}		function updatebubbleChartLegend(){			if(bubbleChartLegend != null){				svgBubbleChart.select(".bubbleChartLegend").remove()			}			createbubbleChartLegend();			if(colors2 != null){				Object.keys(colors2).forEach((color, i) => {					bubbleChartLegend						.append("text")						.attr("y", `${i}em`)						.attr("x", "1em")						.text(colors2[color].name);					bubbleChartLegend						.append("circle")						.attr("cy", `${i - 0.25}em`)						.attr("cx", 0)						.attr("r", "0.4em")						.attr("fill", colors2[color].hex)						.attr("stroke", "black")						.style("opacity", "0.7");				});			}		}				function createSortedBubbleChart(checkbox4, checkbox5){			auxTotalNumberKilled = 0;			auxTotalNumberWounded = 0;			noAvailableAttacksLegend = false;			for(i = 0; i < sumExpenditureValue.length; i++){				bubbleChartData = new Array();				auxTotalNumberKilled += sumExpenditureValue[i].totalNumberKilled				auxTotalNumberWounded += sumExpenditureValue[i].totalNumberWounded				var totalNumberKilledValue = {					name: "totalNumberKilled",					value: wScale(sumExpenditureValue[i].totalNumberKilled)				}				bubbleChartData.push(totalNumberKilledValue)				var totalNumberWoundedValue = {					name: "totalNumberWounded",					value: vScale(sumExpenditureValue[i].totalNumberWounded)				}				bubbleChartData.push(totalNumberWoundedValue)				bubbleChartData.sort(function(a, b){return b.value-a.value});				for(j = 0; j < bubbleChartData.length; j++){					if(bubbleChartData[j].name=="totalNumberKilled" && checkbox4==true){						createBubbleChartToopltip(sumExpenditureValue[i].Year, sumExpenditureValue[i].totalExpenditure, sumExpenditureValue[i].totalNumberKilled)						svgBubbleChart.append("circle")								.attr("class","circleNumberOfKilledForExpenditureValue")								.style("fill", function(d) {									if(sumExpenditureValue[i].totalNumberKilled > 0){										return "#ba484a";									} else {										noAvailableAttacksLegend = true;										return "#D3D3D3";									} 								})							    .style("opacity", "0.7")							    .attr("stroke", "black")								.attr("cx", xScale(sumExpenditureValue[i].Year))						        .attr("cy", yScaleExpenditure(sumExpenditureValue[i].totalExpenditure))						        .attr("r", wScale(sumExpenditureValue[i].totalNumberKilled)+4)						        .on('mouseover.tip', tip5.show)								.on('mouseout.tip', tip5.hide)								.on("mouseover", function(d){									d3.select(this).style("opacity", "1");								}).on("mouseout", function(d){									d3.select(this).style("opacity", "0.7");								})					} else if(bubbleChartData[j].name=="totalNumberWounded" && checkbox5==true){						createBubbleChartToopltip2(sumExpenditureValue[i].Year, sumExpenditureValue[i].totalExpenditure, sumExpenditureValue[i].totalNumberWounded)						svgBubbleChart.append("circle")								.attr("class","circleNumberOfWoundedForExpenditureValue")		        				.style("fill", function(d) {									if(sumExpenditureValue[i].totalNumberWounded > 0){										return "#f28e2c";									} else {										noAvailableAttacksLegend = true;										return "#D3D3D3";									} 								})							    .style("opacity", "0.7")							    .attr("stroke", "black")								.attr("cx", xScale(sumExpenditureValue[i].Year))						        .attr("cy", yScaleExpenditure(sumExpenditureValue[i].totalExpenditure))						        .attr("r", vScale(sumExpenditureValue[i].totalNumberWounded)+4)						        .on('mouseover.tip', tip6.show)								.on('mouseout.tip', tip6.hide)								.on("mouseover", function(d){									d3.select(this).style("opacity", "1");								}).on("mouseout", function(d){									d3.select(this).style("opacity", "0.7");								})					}				}			}			if(checkbox4==true && auxTotalNumberKilled > 0){				var colorsAux = {					NumberOfKilled: {					    hex: "#9d0b0b",					    name: "No. of Killed"					}				};				if(colors2 != null){					Object.assign(colors2,colorsAux);				} else {					colors2 = colorsAux				}			}			if(checkbox5==true && auxTotalNumberWounded > 0){				var colorsAux = {					NumberOfWounded: {					    hex: "#eb8242",					    name: "No. of Wounded"					}				};				if(colors2 != null){					Object.assign(colors2,colorsAux);				} else {					colors2 = colorsAux				}			}			if(auxTotalNumberKilled == 0){				delete colors2["NumberOfKilled"]; 			}			if(auxTotalNumberWounded == 0){				delete colors2["NumberOfWounded"]; 			}			if(noAvailableAttacksLegend == true  && (checkbox4==true || checkbox5==true)){				Object.assign(colors2, {					NoAvailableAttacks: {					    hex: "#D3D3D3",					    name: "No Fatalities"					}				});			}			updatebubbleChartLegend();		}		function createWithVerifications(attacksDataset, createOrNotCreate){			var checkbox4 = false;			var checkbox5 = false;					/*d3.selectAll(".myCheckbox").each(function(d){	     		checkbox = d3.select(this);				if(checkbox.property("value") == "myCheckbox1" && checkbox.property("checked")==true){					svgLineChart.selectAll(".circleNumberOfAttacks").remove()					svgLineChart.selectAll(".lineNumberOfAttacks").remove()					createNumberOfAttacks();				}				if(checkbox.property("value") == "myCheckbox2" && checkbox.property("checked")==true){					svgLineChart.selectAll(".circleNumberOfSuccessfulAttacks").remove()					svgLineChart.selectAll(".lineNumberOfSuccessfulAttacks").remove()					createNumberOfSuccessfulAttacks();				}				if(checkbox.property("value") == "myCheckbox3" && checkbox.property("checked")==true){					svgLineChart.selectAll(".circleNumberOfInternationalAttacks").remove()					svgLineChart.selectAll(".lineNumberOfInternationalAttacks").remove()					createNumberOfInternationalAttacks();				}				if(checkbox.property("value") == "myCheckbox4" && checkbox.property("checked")==true){					checkbox4 = true				}				if(checkbox.property("value") == "myCheckbox5" && checkbox.property("checked")==true){					checkbox5 = true				}			})*/					svgLineChart.selectAll(".circleNumberOfAttacks").remove()					svgLineChart.selectAll(".lineNumberOfAttacks").remove()					createNumberOfAttacks();					svgLineChart.selectAll(".circleNumberOfSuccessfulAttacks").remove()					svgLineChart.selectAll(".lineNumberOfSuccessfulAttacks").remove()					createNumberOfSuccessfulAttacks();					svgLineChart.selectAll(".circleNumberOfInternationalAttacks").remove()					svgLineChart.selectAll(".lineNumberOfInternationalAttacks").remove()					createNumberOfInternationalAttacks();			delete colors2.NoAvailableAttacks			svgBubbleChart.selectAll(".circleNumberOfAttacksForExpenditureValue").remove()			svgBubbleChart.selectAll(".circleNumberOfKilledForExpenditureValue").remove()			svgBubbleChart.selectAll(".circleNumberOfWoundedForExpenditureValue").remove()			//createSortedBubbleChart(checkbox4, checkbox5)			//readDataToFillRadarChart(attacksDataset,"create");			//readDataToFillWordcloud(attacksDataset);		}		function createSlider(attacksDataset){			sliderRange = d3.sliderRight()				.width(110)				.height(400)				.min(d3.min(availableYears))				.max(d3.max(availableYears))				.default([1990,2018])				.ticks(10)				.tickFormat(d3.format('.0f'))				.fill('#328849')				.handle(					d3.symbol()				        .type(d3.symbolCircle)				        .size(200)()			    )				.on('onchange', val => {					minYearAux = minYear					minYear = parseDate(val.map(d3.format('.0f'))[0]);					maxYear = parseDate(val.map(d3.format('.0f'))[1]);					updateGeoJson(attacksDataset);					readDataset(attacksDataset, savedExpenditureDataset);					createWithVerifications(attacksDataset);					readDataBarChart(attacksDataset);					readDataTreemap(attacksDataset);				});			var gRange = d3.select('div#sliderRange')				.append('svg')				.attr('width', 100)				.attr('height', 450)				.append('g')				.attr('transform', 'translate(25, 19)');			gRange.call(sliderRange);		}			function createCheckboxes(attacksDataset){			d3.selectAll(".myCheckbox").on("change", function update(){				var checkbox4 = false;				var checkbox5 = false;				d3.selectAll(".myCheckbox").each(function(d){	         		checkbox = d3.select(this);					if(checkbox.property("value") == "myCheckbox1" && checkbox.property("checked")==true){						svgLineChart.selectAll(".circleNumberOfAttacks").remove()						svgLineChart.selectAll(".lineNumberOfAttacks").remove()						createNumberOfAttacks();					}					if(checkbox.property("value") == "myCheckbox1" && checkbox.property("checked")==false){						svgLineChart.selectAll(".circleNumberOfAttacks").remove()						svgLineChart.selectAll(".lineNumberOfAttacks").remove()						delete colors.NumberOfAttacks						updatelineChartLegend();					}					if(checkbox.property("value") == "myCheckbox2" && checkbox.property("checked")==true){						svgLineChart.selectAll(".circleNumberOfSuccessfulAttacks").remove()						svgLineChart.selectAll(".lineNumberOfSuccessfulAttacks").remove()						createNumberOfSuccessfulAttacks();					}					if(checkbox.property("value") == "myCheckbox2" && checkbox.property("checked")==false){						svgLineChart.selectAll(".circleNumberOfSuccessfulAttacks").remove()						svgLineChart.selectAll(".lineNumberOfSuccessfulAttacks").remove()						delete colors.NumberOfSuccessfulAttacks						updatelineChartLegend();					}					if(checkbox.property("value") == "myCheckbox3" && checkbox.property("checked")==true){						svgLineChart.selectAll(".circleNumberOfInternationalAttacks").remove()						svgLineChart.selectAll(".lineNumberOfInternationalAttacks").remove()						createNumberOfInternationalAttacks();					}					if(checkbox.property("value") == "myCheckbox3" && checkbox.property("checked")==false){						svgLineChart.selectAll(".circleNumberOfInternationalAttacks").remove()						svgLineChart.selectAll(".lineNumberOfInternationalAttacks").remove()						delete colors.NumberOfInternationalAttacks						updatelineChartLegend();					}					if(checkbox.property("value") == "myCheckbox4" && checkbox.property("checked")==false){						svgBubbleChart.selectAll(".circleNumberOfKilledForExpenditureValue").remove()						delete colors2.NumberOfKilled						updatebubbleChartLegend();					}					if(checkbox.property("value") == "myCheckbox4" && checkbox.property("checked")==true){						checkbox4 = true					}					if(checkbox.property("value") == "myCheckbox5" && checkbox.property("checked")==false){						svgBubbleChart.selectAll(".circleNumberOfWoundedForExpenditureValue").remove()						delete colors2.NumberOfWounded						updatebubbleChartLegend();					}					if(checkbox.property("value") == "myCheckbox5" && checkbox.property("checked")==true){						checkbox5 = true					}				})				svgBubbleChart.selectAll(".circleNumberOfKilledForExpenditureValue").remove()				svgBubbleChart.selectAll(".circleNumberOfWoundedForExpenditureValue").remove()				createSortedBubbleChart(checkbox4, checkbox5)			})		}		function createSelection(attacksDataset){			d3.select(".countrySelection").on("change", function update(){						selectedCountry = d3.select(".countrySelection").property("value")				updateAllSelections(attacksDataset);				svgGeoMap.selectAll("path")					.style("stroke-width", "0.4")				if(selectedCountry == "European Union"){					selectCountryTxt = "EU"				}else{					selectCountryTxt = selectedCountry				}				if(selectedCountry == "United Kingdom"){					svgGeoMap.selectAll("path#UnitedKingdom")						.style("stroke-width", "1.4")				}else if(selectedCountry == "Czech Republic"){					svgGeoMap.select("path#CzechRepublic")						.style("stroke-width", "1.4")				}else if(selectedCountry == "Slovak Republic"){					svgGeoMap.select("path#SlovakRepublic")						.style("stroke-width", "1.4")				}else{					svgGeoMap.select("path#"+selectedCountry)						.style("stroke-width", "1.4")  				}  				svgLineChart.selectAll("text#yAxis")					.text("Attacks in " + selectCountryTxt)					svgBubbleChart.selectAll("text#yAxis")					.text("Military Expenditure in " + selectCountryTxt)			})			d3.select(".attackTypeSelection").on("change", function update(){						selectedAttackType = d3.select(".attackTypeSelection").property("value")				selectedBooleanAttackType = true;				updateAllSelections(attacksDataset);			})			d3.select(".targetTypeSelection").on("change", function update(){				selectedTargetType = d3.select(".targetTypeSelection").property("value")				selectedBooleanTargetType = true;				updateAllSelections(attacksDataset);			})        }        function createClearButton(attacksDataset){			d3.select(".clearButton").on("click", function update(){				sliderRange.value([1990, 2018])				minYear = parseDate(1990)				maxYear = parseDate(2018)				selectedCountry = "European Union"				selectedAttackType = "No Attack Type"				selectedTargetType = "No Target Type"				d3.select(".countrySelection").property('value', selectedCountry)				d3.select(".countrySelection").dispatch("change")				d3.selectAll(".myCheckbox").each(function(d){	     			checkbox = d3.select(this);	     			checkbox.property("checked", true);				})								updateAllSelections(attacksDataset);								d3.selectAll(".Country").style("opacity", "1");			})        }        function updateAllSelections(attacksDataset){			readDataset(attacksDataset, savedExpenditureDataset);			updateGeoJson(attacksDataset);			createWithVerifications(attacksDataset);			readDataBarChart(attacksDataset);			readDataTreemap(attacksDataset);		}			 function readDataBarChart(attacksDataset){	 	svgBar.selectAll("g > *").remove();		var years = d3.range(minYear.getFullYear(), maxYear.getFullYear() + 1);		barData = new Array();		var attacksFromThatYear = null;		if(selectedCountry == "European Union"){			attacksFromThatYear = attacksDataset.filter(function (d){				return (years.includes(d.Year.getFullYear()));			});		}else{			attacksFromThatYear = attacksDataset.filter(function (d){				return (years.includes(d.Year.getFullYear()) && ((d.country).trim() === selectedCountry.trim()));			});		}		if(selectedTargetType != "No Target Type"){			attacksFromThatYearAux = attacksFromThatYear.filter(function (d){				return ((d.targetType == selectedTargetType));			});			if(attacksFromThatYearAux.length == 0){				attacksFromThatYear = attacksFromThatYear.filter(function (d){					return ((d.targetSubtype == selectedTargetType));				});			} else {				attacksFromThatYear = attacksFromThatYearAux;			}		}		for(i =0 ; i < attackTypes.length; i++){		    attacksFromThatType = attacksFromThatYear.filter(function (d){					return (d.attackType == attackTypes[i]);			});		    if(attacksFromThatType.length > 0){				var newValue = {					name: attackTypes[i],					totalAttacks: attacksFromThatType.length,				}				barData.push(newValue)			}		}		/*attack Selection box*/	 	d3.selectAll(".attackTypeSelection").selectAll("option").remove()		d3.select(".attackTypeSelection").append("option")				.attr("value", "No Attack Type")            	.text("No Attack Type");        barNames = new Array();		for(i =0 ; i < barData.length; i++){			barNames.push(barData[i].name)		    d3.select(".attackTypeSelection").append("option")				.attr("value", barData[i].name)            	.text(barData[i].name);        }        if(selectedAttackType != "No Attack Type"){        	if(barNames.includes(selectedAttackType)==true){				d3.select(".attackTypeSelection").property("value", selectedAttackType)        	} else {				d3.select(".attackTypeSelection").append("option")					.attr("value", selectedAttackType)                	.text(selectedAttackType)                	.property("selected", selectedAttackType);            }        }		drawHbar(barData);		var max = d3.max(barData, function(d) {return d.totalAttacks;})	 }    function clickedBar(c, i) {		 selectedAttackType = c.name			d3.select(".attackTypeSelection").property('value', selectedAttackType)			d3.select(".attackTypeSelection").dispatch("change")		}	function drawHbar(barData){		var max = d3.max(barData, function(d) {return d.totalAttacks;}) 		const xScale = d3.scaleLinear()		    .range([heightBar, 0])		    .domain([max, 0]);		 const yScale = d3.scaleBand()		    .range([0, widthBar])		    .domain(barData.map((s) => s.name))		    .padding(0.2);		 svgBar.append('g')		    .call(d3.axisLeft(yScale))		    .style("color", "white")		    .style("font-family", "Times New Roman")		    .style("font-size", 14);		svgBar.append('g')		    .attr('transform', `translate(0, ${widthBar})`)		    .call(d3.axisBottom(xScale))		    .style("color", "white")		    .style("font-family", "Times New Roman")		    .style("font-size", 14);		 /*Draw bars*/		svgBar.selectAll()		    .data(barData)		    .enter()		    .append('rect')		    .attr('y', (s) => yScale(s.name))		    .attr('width', (s) => xScale(s.totalAttacks))		    .attr('height', yScale.bandwidth())			.attr('fill',function(d) { return colorBar(d.totalAttacks); })		    .style("opacity", 0.7)		    .on('mouseover.tip', tip7.show)			.on('mouseout.tip', tip7.hide)			.on("mouseover", function(d){				d3.select(this).style("opacity", "1");			}).on("mouseout", function(d){					d3.select(this).style("opacity", "0.6");			})		    .on("click", clickedBar)	    	}	function updateTree(d){				d3.select(this).remove();				var deleteKey = d.key;				svgTree.selectAll("g")					.data(treemap, function(d) {return d.key});				svgTree.selectAll("g").exit().remove();					}	function readDataTreemap(data){ 	d3.selectAll("rect.node").remove();      var years = d3.range(minYear.getFullYear(), maxYear.getFullYear() + 1)      var attacksFromThatYear = null      if(selectedCountry == "European Union"){        attacksFromThatYear = data.filter(function (d){          return (years.includes(d.Year.getFullYear()));        });      }else{        attacksFromThatYear = data.filter(function (d){          return (years.includes(d.Year.getFullYear()) && (d.country === selectedCountry.trim()));        });      }      if(selectedAttackType != "No Attack Type"){        attacksFromThatYear = attacksFromThatYear.filter(function (d){          return ((d.attackType == selectedAttackType));        });      }      targetAndSubTargetAttacks = new Array()      uniqueTargetType = d3.map(data, function(d){return d.targetType;}).keys()      for(i =0 ; i < uniqueTargetType.length; i++){        attacksFromThatTargetType = attacksFromThatYear.filter(function (d){          return (d.targetType == uniqueTargetType[i]);        });        uniqueTargetSubtype = d3.map(attacksFromThatTargetType, function(d){return d.targetSubtype;}).keys()        for(j =0 ; j < uniqueTargetSubtype.length; j++){          attacksFromThatSubTargetType = attacksFromThatTargetType.filter(function (d){            return (d.targetSubtype == uniqueTargetSubtype[j]);          });          attacksCount = attacksFromThatSubTargetType.length            if(uniqueTargetSubtype[j] != "Unknown" && attacksCount >= 5){            var newValue = {              targetType: (uniqueTargetType[i]).trim(),                  targetSubtype: (uniqueTargetSubtype[j]).trim(),                  numberOfAttacks: attacksCount              }                                targetAndSubTargetAttacks.push(newValue)          }         }      }      allNodes = targetAndSubTargetAttacks      sortallNodesTreemap(allNodes);      allNodes.splice(8, (allNodes.length - 8));       d3.selectAll(".targetTypeSelection").selectAll("option").remove()	  d3.select(".targetTypeSelection").append("option")			.attr("value", "No Target Type")	        .text("No Target Type");    TreeNames = new Array();	for(i =0 ; i < allNodes.length; i++){		if (TreeNames.includes(allNodes[i].targetSubtype)== false){			//TreeNames.push(allNodes[i].targetType)			TreeNames.push(allNodes[i].targetSubtype)				    d3.select(".targetTypeSelection").append("option")			.attr("value", allNodes[i].targetSubtype)        	.text(allNodes[i].targetSubtype);        	}	    }    if(selectedTargetType != "No Attack Type"){    	if(TreeNames.includes(selectedTargetType)==true){			d3.select(".targetTypeSelection").property("value", selectedTargetType)    	} else {			d3.select(".targetTypeSelection").append("option")				.attr("value", selectedTargetType)            	.text(selectedTargetType)            	.property("selected", selectedTargetType);        }    }          drawTreemap(allNodes);      return allNodes;    }  function sortallNodesTreemap(allNodes){      //order values for graph links      allNodes.sort(function(a, b) {      return b.numberOfAttacks - a.numberOfAttacks;       });    }    function clickedTree(c, i) {	 selectedTargetType = c.data.key			d3.select(".targetTypeSelection").property('value', selectedTargetType)			d3.select(".targetTypeSelection").dispatch("change")	} function drawTreemap(data){	  var rootTree = d3.hierarchy({values: nestTree.entries(data)}, function(d) { return d.values; })    .sum(function(d) { return d.value; })    .sort(function(a, b) { return b.value - a.value; });  treemap(rootTree); var svgTree = d3.select("div#Treemap")		    	.selectAll()    	.attr("class", "removeTree")	    .data(rootTree.leaves())	    .enter().append("rect")	      .attr("class", "node")			.on("mouseover", function(d){				d3.select(this).style("opacity", "0.8");				 tip8.show(d, this);			}).on("mouseout", function(d){					d3.select(this).style("opacity", "1");			})	      .on("click", clickedTree)	      .style("left", function(d) { return d.x0 * 3.1 + "px"; })	      .style("top", function(d) { return d.y0 * 1.1 + "px"; })	      .style("width", function(d) { return (d.x1 - d.x0)* 3.1 + "px"; })	      .style("height", function(d) { return (d.y1 - d.y0)*1.1 + "px"; })	      .style('background',function(d) { return colorTree(d.parent.value); })  svgTree.append("text")      .attr("class", "node-label")      .text(function(d) { return  d.parent.data.key + "\n" + d.data.key + "\n"; });  svgTree.append("text")      .attr("class", "node-value")      .text(function(d) {	 return d.value; });};	</script>	</body></html>
<!DOCTYPE html><head>	<meta charset="utf-8">	<title>The Rise Of Terrorism In the EU</title>	<script src="Scripts/d3.v5.js"></script>	<script src="Scripts/d3.tip.js"></script>	<script src="Scripts/d3.slider.js" ></script>	<script src="Scripts/d3.radarChart.js" charset="utf-8"></script>	<script src="Scripts/d3.seedrandom.js"></script>	<script src="Scripts/d3.layout.cloud.js"></script>	<script src="Scripts/sankey.js"></script>	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> <!-- For info icon -->	<div id="block_container">		<div id="selectCountry">			<select class="countrySelection" style="width: 180px">				<option value ="European Union" selected>European Union</option>				<option value ="Austria">Austria</option>				<option value ="Belgium">Belgium</option>				<option value ="Bulgaria">Bulgaria</option>				<option value ="Croatia">Croatia</option>				<option value ="Cyprus">Cyprus</option>				<option value ="Czech Republic">Czech Republic</option>				<option value ="Denmark">Denmark</option>				<option value ="Estonia">Estonia</option>				<option value ="Finland">Finland</option>				<option value ="France">France</option>				<option value ="Germany">Germany</option>				<option value ="Greece">Greece</option>				<option value ="Hungary">Hungary</option>				<option value ="Ireland">Ireland</option>				<option value ="Italy">Italy</option>				<option value ="Latvia">Latvia</option>				<option value ="Lithuania">Lithuania</option>				<option value ="Luxembourg">Luxembourg</option>				<option value ="Netherlands">Netherlands</option>				<option value ="Poland">Poland</option>				<option value ="Portugal">Portugal</option>				<option value ="Romania">Romania</option>				<option value ="Slovak Republic">Slovak Republic</option>				<option value ="Slovenia">Slovenia</option>				<option value ="Spain">Spain</option>				<option value ="Sweden">Sweden</option>				<option value ="United Kingdom">United Kingdom</option>			</select>		</div>		<div id="selectTargetType">			<select class="targetTypeSelection" style="width: 180px">				<option value ="No Target Type" selected>Target Type</option>			</select>		</div>		<div id="selectAttackType">			<select class="attackTypeSelection" style="width: 180px">				<option value ="No Attack Type" selected>Attack Type</option>			</select>		</div>		<div id="sliderRange"></div>		<div id="clearButton">			<input type="button" class="clearButton" value="Default View" style="font-family: Times New Roman">		</div>	</div>		<div id="block_container2">		<table class="box">		<td><div id="GeoMercator"></div>			<div id="Map">				<div class="tooltip" id="tooltipGeoMap">					<i class="fa fa-info-circle"></i>					<span class="tooltiptext">The Choropleth shows the number of terrorist attacks per country.</span>				</div>			</div>			<div id="geoLegend"></div>		</div></td>		<td><div id="LineChart">			<div class="tooltip" id="tooltipLineChart">				<i class="fa fa-info-circle"></i>				<span class="tooltiptext">The Line Chart shows the evolution of the number of terrorist attacks over the years, as well as the number of successful and international attacks.</span>			</div>			<!-- <div class="checkboxOverall" style="color:white;">				<input type="checkbox" class="myCheckbox" value="myCheckbox1" checked="checked" > Total Attacks				<input type="checkbox" class="myCheckbox" value="myCheckbox2" checked="checked" > Successful Attacks 				<input type="checkbox" class="myCheckbox" value="myCheckbox3" checked="checked" > International Attacks			</div> -->		</div></td>		</div>	</div>	<div id="block_container3">			<tr>			<td ><div id="SankeyDiagram">					<div class="tooltip" id="tooltipSankey">						<i class="fa fa-info-circle"></i>						<span class="tooltiptext">The Sankey diagram displays the hierarchical relationship between target types and target sub-types, as well as the number of attacks for each type.</span>					</div>				</div>			</td>					<td><div id="BarChart">					<div class="tooltip" id="tooltipBarChart">						<i class="fa fa-info-circle"></i>					<span class="tooltiptext">The Bar Chart displays a comparison of the total number of attacks for each attack type.</span>						</div>						</div>				</td>			</tr>		</div>	</table>		<style type="text/css">		.line {			fill: none			stroke: #000		}		.dot {			stroke: #000		}		.fa {		  background-color: #404040; /*grey background*/		  border: none;		  color: #848c83; /*grey*/		  font-size: 20px;		  cursor: pointer;		}		table {  			border-collapse: collapse;    	}		td {			border: 3px solid 	#a4a4a3;	    	padding-left: 8px;	    	padding-right: 8px;	    	padding-top: 10px;	    	padding-bottom: 10px;    	}    	select {		   font-family: Times New Roman;		   font-size: 16px;		}    	.box {		    margin-left:50px; /* half of width */		}		.tooltip {  			font-size: 18px;  			z-index: 1;  			color:	#58b367;		}    	#tooltipGeoMap {  			position:absolute;  			left: 70px;  			font-size: 18px;		}		#tooltipLineChart  {  			position:absolute;  			left: 0px;  			top: 6px;  			font-size: 18px;		}		#tooltipSankey {  			position:absolute;  			left: 2px;  			top: 0px;  			font-size: 18px;		}		#tooltipBarChart  {  			position:absolute;  			left: 0px;  			top: 0px;  			font-size: 18px;		}		.tooltip .tooltiptext {			visibility: hidden;			background: rgba(0, 0, 0, 0.7);			color: white;			text-align: center;			font-size: 16px;			padding: 4px;			position: absolute;			left: 20px;			width: 300px;  			z-index: 1;		}		.tooltip:hover .tooltiptext {		  visibility: visible;		}		.checkboxOverall {		  	position: relative;		    font-size :12px;		    left: 120px;		    top: 330px;	  	}		.checkboxOverall2 {		  	position: relative;		    font-size :12px;		    left: 170px;		    top: 330px;	  	}		#block_container {			display: flex;			margin-left:80px;	    	justify-content: left;	     	padding-top: 10px;	     	height: 63px;		}		    		#selectCountry {			font-size :14px;		    padding-top: 10px;		}		#selectVariable {			font-size :14px;		    padding-top: 10px;		    padding-left: 10px;		}		#selectTargetType {			font-size :14px;		    padding-top: 10px;		    padding-left: 10px;		}		#selectAttackType {			font-size :14px;		    padding-top: 10px;		    padding-left: 10px;		}		#block_container2 {			display: flex;	    	justify-content: left;		}		#block_container3 {			display: flex;	    	justify-content: left;		}		#GeoMap {		  	position: relative;		    top: 10px;			}		#LineChart {		  	position: relative;		  	top: -10px;		    left: 30px;	  	}		#BubbleChart {		  	position: relative;		  	top: -10px;		    left: 15px;	  	}	  	#BarChart {		  	position: relative;		  	top: 0px;		    left: 30px;	  	}	  	#SankeyDiagram {		  	position: relative;		    left: 15px;	  	}	  	#PieChart {		  	position: relative;		    left: 100px;	  	}		#sliderRange {		    padding-left: 10px;		}		#clearButton {			font-size :20px;		    padding-top: 10px;		    padding-left: 10px;		}		.d3-tip table {			background: rgba(0, 0, 0, 0.7);			color: white;			font-size: 18px;			position: r;			padding: 2px;		}		.d3-tip td {			border: none;			padding-left: 4px;	    	padding-right: 4px;	    	padding-top: 4px;	    	padding-bottom: 4px;		}		/*Sankey variables start*/		.node rect {		/*  cursor: move;*/		  fill-opacity: .9;		  shape-rendering: crispEdges;		}		.node text {		 /* pointer-events: none;*/		  text-shadow: 0 1px 0 #fff;		}		.link {		  fill: none;		  stroke: #000;		  stroke-opacity: .2;		}		.link:hover {		  stroke-opacity: .5;		}		body {		  font-family: "Times New Roman", serif;		  position: relative;		  font-size: 16px;		  background-color: #404040;		}		/*Sankey variables end*/	</style></head><body>	<script type="text/javascript">		var availableYears = [1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,			2012,2013,2014,2015,2016,2017,2018];		var europe = ["Austria","Belgium","Bulgaria","Croatia","Cyprus","Czech Republic", "Denmark", "Estonia", "Finland", "France", "Germany", "Greece", "Hungary", 				    "Ireland", "Italy", "Latvia", "Lithuania", "Luxembourg", "Netherlands", "Poland", "Portugal", "Romania", "Slovak Republic", "Slovenia",				    "Spain", "Sweden", "United Kingdom"];		var attackTypes = ["Assalto", "Assassinato", "Bombardeamento", "Infraestrutura", "Ref√©ns"]		var radarChartColors = ["rgb(89, 161, 79)", "rgb(78, 121, 167)", "rgb(225, 87, 89)", "rgb(242, 142, 44)", "rgb(237, 201, 73)"]	    var geoTicks = [1, 10, 25, 50, 100, 250, 500, 1250, 2500]		var margin = {top: 20, right: 20, bottom: 20, left: 50},		    width = 500 - margin.left - margin.right,		    originalWidth = 520,		    height = 310 - margin.top - margin.bottom,		    originalHeight = 310;		const parseDate = d3.timeParse('%Y');		var selectedCountry = "European Union"		var selectedBoolean = false		var selectCountryTxt = ""		if(selectedCountry == "European Union"){			selectCountryTxt = "EU"		}else{			selectCountryTxt = selectedCountry		}		var selectedTargetType = "No Target Type"		var selectedBooleanTargetType = false		var selectedAttackType = "No Attack Type"		var selectedBooleanAttackType = false		var minYear = parseDate(1990)		var maxYear = parseDate(2018)		var svgGeoMap = d3.select("div#Map")	        .append("svg")	        .attr("width", width + 120)	        .attr("height", height+40)	        .attr("transform", "translate(" + 70 + "," + 0 +")")         	    var geoPath = d3.geoPath();	    var projection = d3.geoMercator()			.scale(385)			.center([0,54])			.translate([width / 2, height / 2])		var mapData = d3.map();		var colorScale = d3.scaleThreshold()		  	.domain(geoTicks)			.range(d3.schemeGreens[9]);		var geoLegend = d3.select("div#geoLegend")	        .append("svg")	        .attr("width", 610)	        .attr("height", 25)	        .attr("transform", "translate(" + 80 + "," + 2 +")")	        .style("color", "#e3eee2")	        .style("font-family", "Times New Roman")	        .style("font-size", 14);   	    var x = d3.scaleLinear()		  	.domain(geoTicks)			.rangeRound([0, 610]);		var color = d3.scaleThreshold()		    .domain(d3.range(1, 11))		    .range(d3.schemeGreens[9]);		geoLegend.selectAll("rect")			.data(color.range().map(function(d) {				d = color.invertExtent(d);				if (d[0] == null) d[0] = x.domain()[0];				if (d[1] == null) d[1] = x.domain()[1];				return d;		    }))			.enter().append("rect")				.attr("height", 8)				.attr("x", function(d) { return x(d[0]); })				.attr("width", function(d) { return x(d[1]) - x(d[0]); })				.attr("fill", function(d) { return color(d[0]); });		geoLegend.call(d3.axisBottom(x)					.tickSize(8)					.tickValues(color.domain())					.tickFormat(function(d,i){ return geoTicks[i] })				)				.select(".domain")   					.remove();		const xScale = d3.scaleTime();		const yScale = d3.scaleLinear();		xScale.range([0, width]);  		yScale.range([height, 0]);  		xScale.domain([minYear, maxYear])		yScale.domain([0, 750+(750*0.25)])		var xAxis = d3.axisBottom()			.scale(xScale)			.tickFormat(d3.timeFormat("%Y"))			.ticks(8);  		const yAxis = d3.axisLeft()			.scale(yScale)			.ticks(10);				var svgLineChart = d3.select("div#LineChart")			.append("svg")			.attr("width", originalWidth + 120)			.attr("height", originalHeight + 30)			.append("g")			.attr("transform", "translate(" + 130 + "," + 30 +")") ;		svgLineChart.append("g")			.attr("class", "xAxis")			.attr("transform", "translate(0, " + height +")")			.call(xAxis)			.style("color", "white")			.style("font-family", "Times New Roman")			.style("font-size", 14); 		svgLineChart.append("text")			.attr("id", "xAxis")          			.attr("transform","translate(" + (width/2) + " ," + (height + margin.top + 15) + ")")			.style("text-anchor", "middle")			.style("font-size", "16px")			.text("Year")			.style("fill", "white")			.style("font-family", "Times New Roman");		svgLineChart.append("g")			.attr("class", "yAxis")			.call(yAxis)			.style("color", "white")			.style("font-family", "Times New Roman")			.style("font-size", 14)		svgLineChart.append("text")			.attr("id", "yAxis")          			.attr("transform", "rotate(-90)")			.attr("y", 0 - margin.left - 10)			.attr("x",0 - (height / 2))			.attr("dy", "1em")			.style("text-anchor", "middle")			.style("font-size", "16px")			.text("Attacks in " + selectCountryTxt)			.style("fill", "white")			.style("font-family", "Times New Roman");		var valueline1 = d3.line()			.x(function(d) { return xScale(d.Year);})			.y(function(d) { return yScale(d.totalNumberOfAttacks);})		var valueline2 = d3.line()			.x(function(d) { return xScale(d.Year);})			.y(function(d) { return yScale(d.totalSuccessfulAttacks);})		var valueline3 = d3.line()			.x(function(d) { return xScale(d.Year);})			.y(function(d) { return yScale(d.totalInternationalAttacks);})		var svgBubbleChart = d3.select("div#BubbleChart")			.append("svg")			.attr("width", originalWidth)			.attr("height", originalHeight)			.append("g")			.attr("transform", "translate(" + (margin.left+7) + "," + (5) +")")		svgBubbleChart.append("g")			.attr("class", "xAxis")			.attr("transform", "translate(0, " + height +")")			.call(xAxis).style("color", "white")		svgBubbleChart.append("text")			.attr("id", "xAxis")          			.attr("transform","translate(" + (width/2) + " ," + (height + margin.top + 15) + ")")			.style("text-anchor", "middle")			.style("font-size", "11px")			.text("Year")			.style("fill", "white");		svgBubbleChart.append("text")			.attr("id", "yAxis")          			.attr("transform", "rotate(-90)")			.attr("y", 0 - margin.left - 10)			.attr("x",0 - (height / 2))			.attr("dy", "1em")			.style("text-anchor", "middle")			.style("font-size", "11px")			.text("Military Expenditure in " + selectedCountry)			.style("fill", "white"); 		const yScaleExpenditure = d3.scaleLinear();  		yScaleExpenditure.range([height, 0]);		yScaleExpenditure.domain([0, 300000+(300000*0.25)])		const yAxisExpenditure = d3.axisLeft()			.scale(yScaleExpenditure)			.ticks(10)			.tickFormat(function(d) { return(numberFormatter(d)); });					svgBubbleChart.append("g")			.attr("class", "yAxisExpenditure")			.call(yAxisExpenditure).style("color", "white")			/*barc chart variables start*/	    const marginBar = 100;	    const widthBar = 480 - 2 * marginBar;	    const heightBar = 650 - 2 * marginBar;	    var svgBar = d3.select("div#BarChart")			.append("svg")			.attr("width", originalWidth+200)			.attr("height", originalHeight + 10)			.append("g")	    	.attr('transform', `translate(${marginBar + 30}, ${marginBar-100})`);		 var colorBar = d3.scaleLinear()		    .domain([0, 500,1000, 2000, 3000, 4000 ,5000])  		    .range(["#c7e9c0", "#a1d99b", "#74c476", "#41ab5d", "#238b45", "#006d2c", "#00441b"]); /*verdes*/		    /*barc chart variables end*/       	/*Sankey diagram  start*/		var unitsSankey = "attacks";		var marginSankey = {top: 10, right: 30, bottom: 10, left: 45},		    widthSankey = 650 - marginSankey.left - marginSankey.right,		    heightSankey = 310 - marginSankey.top - marginSankey.bottom;		var formatNumberSankey = d3.format(",.0f"),    // zero decimal places		    format = function(d) { return formatNumberSankey(d) + " " + unitsSankey; };		    //color = d3.scaleOrdinal(d3.schemeCategory10);		   /* color = d3.scaleOrdinal()		    .range(d3.schemeGreens[7]		      .map(function(c){		        c = d3.rgb(c);		        c.opacity = 1;		        return c;		      }))*/		  var colorSankey = d3.scaleLinear()		    .domain([0, 300,600, 700, 900, 1100 ,1300])  		    .range(["#c7e9c0", "#a1d99b", "#74c476", "#41ab5d", "#238b45", "#006d2c", "#00441b"]); /*verdes*/		// append the svg canvas to the page		var svgSankey = d3.select("#SankeyDiagram").append("svg")		    .attr("width", widthSankey + marginSankey.left + marginSankey.right)		    .attr("height", heightSankey + marginSankey.top + marginSankey.bottom)		  .append("g")		    .attr("transform", 		          "translate(" + marginSankey.left + "," + marginSankey.top + ")");		// Set the sankey diagram properties		var sankey = d3.sankey()		    .nodeWidth(36)		    .nodePadding(40)		    .size([widthSankey, heightSankey]);		var pathSankey = sankey.link();       	/*Sankey diagram end*/		var zScale = d3.scaleLinear();		var wScale = d3.scaleLinear();		var vScale = d3.scaleLinear();		var lineChartLegend = null		var bubbleChartLegend = null		var colors = null		var colors2 = null		var tip1 = d3.tip()		var tip2 = d3.tip()		var tip3 = d3.tip()		var tip4 = d3.tip()		var tip5 = d3.tip()		var tip6 = d3.tip()		var tip7 = d3.tip() //BarChart		var tip8 = d3.tip() //Sankey		var tip9 = d3.tip()		var tip10 = d3.tip()		var sumAttacks = new Array();		var sumSuccessfulAttacks = new Array();		var sumInternationalAttacks = new Array();		var sumExpenditureValue = new Array();		var radarData = new Array();		var sliderRange;		savedAttacksDataset = null;		savedExpenditureDataset = null;		d3.csv("Data/GlobalTerrorismCleaned.csv", function(d) {		    return {		    	country: (d.country).trim(),				Year: parseDate(d.Year),				success: parseInt(d.success),				internationalAttack: parseInt(d.internationalAttack),				attackType: (d.attackType).trim(),				targetType: (d.targetType).trim(),				targetSubtype: (d.targetSubtype).trim(),				terroristGroup: (d.terroristGroup).trim(),				numberKilled: parseInt(d.numberKilled),				numberWounded: parseInt(d.numberWounded)		    };  			}).then(function(data) {		    	for(i =0 ; i < data.length; i++){					if(data[i].targetType.trim() == data[i].targetSubtype.trim()){						data[i].targetSubtype = ( "Institutions " + data[i].targetSubtype).trim()					}					if((data[i].targetType.trim()!="Politician") && (data[i].targetSubtype.trim()=="Politician")){						data[i].targetType = "Government"						data[i].targetSubtype = "Government Institutions"					}				}									//createCheckboxes(data);				createSlider(data);				createSelection(data);				createClearButton(data);				createlineChartLegend();				createbubbleChartLegend();				createToolTips();				readDataToFillMap(data);				readGeoJson(data);				drawSankey(data);				readDataBarChart(data);				joinAttacksDatasetWithExpenditureDatasetForCreation(data);   		});		function readDataToFillMap(attacksDataset){			var years = d3.range(minYear.getFullYear(), maxYear.getFullYear() + 1)			attacksFromThatYear = attacksDataset.filter(function (d){				return (years.includes(d.Year.getFullYear()));			});			if(selectedAttackType != "No Attack Type"){				attacksFromThatYear = attacksFromThatYear.filter(function (d){					return ((d.attackType == selectedAttackType));				});			}			if(selectedTargetType != "No Target Type"){				attacksFromThatYearAux = attacksFromThatYear.filter(function (d){					return ((d.targetType == selectedTargetType));				});				if(attacksFromThatYearAux.length == 0){					attacksFromThatYear = attacksFromThatYear.filter(function (d){						return ((d.targetSubtype == selectedTargetType));					});				} else {					attacksFromThatYear = attacksFromThatYearAux;				}			}		    for(i =0 ; i < europe.length; i++){			    attacksFromThatCountry = attacksFromThatYear.filter(function (d){					return (d.country == europe[i]);				});				totalValue = attacksFromThatCountry.length				mapData.set(europe[i], totalValue)			}		}		function readGeoJson(attacksDataset){			d3.json("Data/world.geojson").then(data => {				let mouseOver = function(d) {					if(europe.includes(d3.select(this).attr("id")) || d3.select(this).attr("id")=="UnitedKingdom" || d3.select(this).attr("id")=="CzechRepublic" || d3.select(this).attr("id")=="SlovakRepublic"){						d3.selectAll(".Country")							.filter(function() {								auxId = this.id								if(this.id == "UnitedKingdom"){							   		auxId = "United Kingdom"							   	}else if(this.id == "CzechRepublic"){							   		auxId = "Czech Republic"								}else if(this.id == "SlovakRepublic"){									auxId = "Slovak Republic"						   		}							    return auxId != selectedCountry							})							.transition()							.duration(100)							.style("opacity", 0.5)				    	d3.select(this)							.transition()							.duration(100)							.style("opacity", 1)					}				}				let mouseLeave = function(d) {					if(selectedCountry=="European Union"){						d3.selectAll(".Country")							.transition()							.duration(100)							.style("opacity", 1)					}				    d3.select(this)						.transition()						.duration(100)						.style("opacity", 1)				}				let click = function(d) {					if(europe.includes(d3.select(this).attr("id")) || d3.select(this).attr("id")=="UnitedKingdom" || d3.select(this).attr("id")=="CzechRepublic" || d3.select(this).attr("id")=="SlovakRepublic"){					  	if(selectedBoolean == false){					  		d3.selectAll(".Country").style("opacity", .5)							d3.select(this).style("stroke-width", 1.4)							d3.select(this).style("opacity", 1)						    selectedBoolean = true;						    if(d3.select(this).attr("id") == "UnitedKingdom"){						   		selectedCountry = "United Kingdom"						   	}else if(d3.select(this).attr("id") == "CzechRepublic"){						   		selectedCountry = "Czech Republic"							}else if(d3.select(this).attr("id") == "SlovakRepublic"){								selectedCountry = "Slovak Republic"						    } else {						    	selectedCountry = d3.select(this).attr("id")						    }						    d3.select(".countrySelection").property('value', selectedCountry)							d3.select(".countrySelection").dispatch("change")						} else {							if(d3.select(this).attr("id")==selectedCountry || (d3.select(this).attr("id")=="UnitedKingdom" && selectedCountry=="United Kingdom")  								|| (d3.select(this).attr("id")=="CzechRepublic" && selectedCountry=="Czech Republic") 								|| (d3.select(this).attr("id")=="SlovakRepublic" && selectedCountry=="Slovak Republic")){								d3.selectAll(".Country").style("opacity", 1)								d3.select(this).style("stroke-width", 0.4)							    selectedBoolean = false;							    d3.select(".countrySelection").property('value', "European Union")								d3.select(".countrySelection").dispatch("change")							} else {								d3.selectAll(".Country").style("opacity", .5)								d3.select(this).style("stroke-width", 1.4)								d3.select(this).style("opacity", 1)							    selectedBoolean = true;							    if(d3.select(this).attr("id") == "UnitedKingdom"){							   		selectedCountry = "United Kingdom"							   	}else if(d3.select(this).attr("id") == "CzechRepublic"){							   		selectedCountry = "Czech Republic"								}else if(d3.select(this).attr("id") == "SlovakRepublic"){									selectedCountry = "Slovak Republic"							    } else {							    	selectedCountry = d3.select(this).attr("id")						  	  	}						  	  	selectedBoolean = true;						  	  	d3.select(".countrySelection").property('value', selectedCountry)								d3.select(".countrySelection").dispatch("change")							} 						}					}				}			   	svgGeoMap.append("g")					.selectAll("path")					.data(data.features)					.enter()					.append("path")						.attr("class", function(d){ return "Country" } )						.attr("id", function(d){ return (d.properties.name).replace(/\s/g, ""); } )						.attr("d", d3.geoPath()							.projection(projection)						)						.attr("fill", function (d) {							if(europe.includes(d.properties.name)){								d.total = mapData.get(d.properties.name) || 0;								return colorScale(d.total);							} else {								return "#f7f7f7";							}												})						.style("stroke", "black")						.style("stroke-width", "0.4")						.style("opacity", 1)						.on("mouseover", mouseOver)			  			.on("mouseleave", mouseLeave)			  			.on("click", click)			  			.on('mouseover.tip', tip4.show)						.on('mouseout.tip', tip4.hide)			});		}		function updateGeoJson(attacksDataset){			readDataToFillMap(attacksDataset)		    svgGeoMap.selectAll("path")		    	.attr('fill', function(d) {			    	if(europe.includes(d.properties.name)){						d.total = mapData.get(d.properties.name) || 0;						return colorScale(d.total);					} else {						return "#f7f7f7";					} 			 	});		}		function joinAttacksDatasetWithExpenditureDatasetForCreation(attacksDateset){  			d3.csv("Data/EUMilitaryExpenditureCleaned.csv", function(d) {			    return {			    	country: (d.country).trim(),					Year: parseDate(d.year),					militaryExpenditure: parseInt(d.value)			    };  			}).then(function(expenditureDataset) {  				readDataset(attacksDateset, expenditureDataset);				createNumberOfAttacks();				createNumberOfSuccessfulAttacks();				createNumberOfInternationalAttacks();				createSortedBubbleChart(true, true);							savedAttacksDataset = attacksDateset;				savedExpenditureDataset = expenditureDataset;			})  		}		function readDataset(attacksDataset, expenditureDataset){			sumAttacks = new Array();			sumSuccessfulAttacks = new Array();			sumInternationalAttacks = new Array();			sumExpenditureValue = new Array();			var years = d3.range(minYear.getFullYear(), maxYear.getFullYear() + 1)			for (var i in years) {				const year = years[i]				var attacksFromThatYear = null				var attacksFromThatYearForExpenditure = null				if(selectedCountry == "European Union"){					attacksFromThatYear = attacksDataset.filter(function (d){						return (d.Year.getFullYear() == year);					});					attacksFromThatYearForExpenditure = expenditureDataset.filter(function (d){						return (d.Year.getFullYear() == year);					});				}else{					attacksFromThatYear = attacksDataset.filter(function (d){						return ((d.Year.getFullYear() == year) && (d.country === selectedCountry.trim()));					});					attacksFromThatYearForExpenditure = expenditureDataset.filter(function (d){						return ((d.Year.getFullYear() == year) && (d.country === selectedCountry.trim()));					});				}				if(selectedAttackType != "No Attack Type"){					attacksFromThatYear = attacksFromThatYear.filter(function (d){						return ((d.attackType == selectedAttackType));					});				}				if(selectedTargetType != "No Target Type"){					attacksFromThatYearAux = attacksFromThatYear.filter(function (d){						return ((d.targetType == selectedTargetType));					});					if(attacksFromThatYearAux.length == 0){						attacksFromThatYear = attacksFromThatYear.filter(function (d){							return ((d.targetSubtype == selectedTargetType));						});					} else {						attacksFromThatYear = attacksFromThatYearAux;					}				}				sumAttacks.push({					Year: parseDate(year),					totalNumberOfAttacks: attacksFromThatYear.length				})				sumSuccessfulAttacks.push({					Year: parseDate(year),					totalSuccessfulAttacks: d3.sum(attacksFromThatYear, d => d.success)				})				sumInternationalAttacks.push({					Year: parseDate(year),					totalInternationalAttacks: d3.sum(attacksFromThatYear, d => d.internationalAttack)				})				sumExpenditureValue.push({					Year: parseDate(year),					totalNumberOfAttacks: attacksFromThatYear.length,					totalNumberKilled: d3.sum(attacksFromThatYear, d => d.numberKilled),					totalNumberWounded: d3.sum(attacksFromThatYear, d => d.numberWounded),					totalExpenditure: d3.sum(attacksFromThatYearForExpenditure, d => d.militaryExpenditure)				})			}			xScale.domain([minYear, maxYear])			var tickNumber = (maxYear.getFullYear()-minYear.getFullYear()) + 1			if(tickNumber < 10){				xAxis.ticks(tickNumber);			}			d3.selectAll("g").selectAll(".xAxis")   				.call(xAxis);			var maxsumAttacks = d3.max(sumAttacks, d => d.totalNumberOfAttacks)			yScale.domain([0, maxsumAttacks+(maxsumAttacks*0.25)])			d3.selectAll("g").selectAll(".yAxis")   				.call(yAxis);   			var maxsumExpenditure = d3.max(sumExpenditureValue, d => d.totalExpenditure)   			var minsumExpenditure = d3.min(sumExpenditureValue, d => d.totalExpenditure)			yScaleExpenditure.domain([(minsumExpenditure-(minsumExpenditure*0.20)), maxsumExpenditure+(maxsumExpenditure*0.20)])			d3.selectAll("g").selectAll(".yAxisExpenditure")   				.call(yAxisExpenditure);			zScale.domain([0, maxsumAttacks])			zScale.range([1, 20]);			var maxsumKilled = d3.max(sumExpenditureValue, d => d.totalNumberKilled)			wScale.domain([0, maxsumKilled])			wScale.range([1, 20]);			var maxsumWounded = d3.max(sumExpenditureValue, d => d.totalNumberWounded)			vScale.domain([0, maxsumWounded])			vScale.range([1, 20]);		}								function createlineChartLegend(){			lineChartLegend = svgLineChart.append("g")						.attr("class", "lineChartLegend")						.attr("transform", `translate(300, 5)`)						.style("font-size", "14px");		}		function updatelineChartLegend(){			if(lineChartLegend != null){				lineChartLegend.remove()			}			createlineChartLegend();			Object.keys(colors).forEach((color, i) => {				lineChartLegend					.append("text")					.attr("fill", "white")					.attr("y", `${i}em`)					.attr("x", "1em")					.text(colors[color].name);				lineChartLegend					.append("circle")					.attr("cy", `${i - 0.25}em`)					.attr("cx", 0)					.attr("r", "0.4em")					.attr("fill", colors[color].hex);			});		}		function createToolTips(){			tip1 = d3.tip()					.attr('class', 'd3-tip')					.offset([-5, 0])					.html(function (d) {						var content = "<table style=\"margin-top: 1px;\"><tr><td>" + d.Year.getFullYear() +						    " : </td><td style=\"text-align: center\">" + d.totalNumberOfAttacks + "</td></tr></table>"						return content;		    		});	    	svgLineChart.call(tip1);	    	tip2 = d3.tip()					.attr('class', 'd3-tip')					.offset([-5, 0])					.html(function (d) {						var content = "<table style=\"margin-top: 1px;\"><tr><td>" + d.Year.getFullYear() +						    " : </td><td style=\"text-align: center\">" + d.totalSuccessfulAttacks + "</td></tr></table>"						return content;		    		});		    svgLineChart.call(tip2);			tip3 = d3.tip()					.attr('class', 'd3-tip')					.offset([-5, 0])					.html(function (d) {						var content = "<table style=\"margin-top: 1px;\"><tr><td>" + d.Year.getFullYear() +						    " : </td><td style=\"text-align: center\">" + d.totalInternationalAttacks + "</td></tr></table>"						return content;		   			});	    	svgLineChart.call(tip3);	    	tip4 = d3.tip()		        .attr('class', 'd3-tip')		        .offset([-5, 0])		        .html(function (d) {		        	if(europe.includes(d.properties.name) || d.properties.name=="UnitedKingdom" || d.properties.name=="CzechRepublic" || d.properties.name=="SlovakRepublic"){						var content = "<table style=\"margin-top: 1px;\"><tr><td>" + d.properties.name +						    " : </td><td style=\"text-align: center\">" + d.total + "</td></tr></table>"						return content;					}		   		});	    	svgGeoMap.call(tip4);	    	tip7 = d3.tip()		        .attr('class', 'd3-tip')		        .offset([-5, 0])		        .html(function (d) {		        	var content = "<table style=\"margin-top: 1px;\"><tr><td>" + "Total Attacks" +						" : </td><td style=\"text-align: center\">" + d.totalAttacks + "</td></tr></table>"					return content;		   		});	    	svgBar.call(tip7);	         tip8 = d3.tip()		        .attr('class', 'd3-tip')		        .offset([-5, 0])		        .html(function (d) {		        	var content = "<table style=\"margin-top: 1px;\"><tr><td>" + "Total Attacks" +						" : </td><td style=\"text-align: center\">" + d.value + "</td></tr></table>"					return content;		   		});	    	svgSankey.call(tip8);		}		function numberFormatter(num) {			if (num >= 1000000000) {				return (num / 1000000000).toFixed(1).replace(/\.0$/, '') + 'G';			}			if (num >= 1000000) {				return (num / 1000000).toFixed(1).replace(/\.0$/, '') + 'M';			}			if (num >= 1000) {				return (num / 1000).toFixed(1).replace(/\.0$/, '') + 'K';			}				return num;			}		function createBubbleChartToopltip(year, totalExpenditure, totalNumberKilled){			tip5 = d3.tip()				.attr('class', 'd3-tip')				.offset([-5, 0])				.html(function (d) {					var content = "<table style=\"margin-top: 1px;\"><tr><td>" + year.getFullYear() +					    " : </td><td>" + numberFormatter(totalExpenditure) + " : </td><td style=\"text-align: center\">" + totalNumberKilled + "</td></tr></table>"					return content;	    		});		    svgLineChart.call(tip5);		}		function createBubbleChartToopltip2(year, totalExpenditure, totalNumberWounded){			tip6 = d3.tip()				.attr('class', 'd3-tip')				.offset([-5, 0])				.html(function (d) {					var content = "<table style=\"margin-top: 1.5px;\"><tr><td>" + year.getFullYear() +					    " : </td><td>" + numberFormatter(totalExpenditure) + " : </td><td style=\"text-align: center\">" + totalNumberWounded + "</td></tr></table>"					return content;	    		});		    svgLineChart.call(tip6);		}		function createNumberOfAttacks(){			svgLineChart.selectAll(".circleNumberOfAttacks")				.data(sumAttacks)				.enter()				.append("circle")		        	.attr("class","circleNumberOfAttacks")			        .attr("fill", "transparent")			        .attr("r", "8")			        .attr("opacity", "1")		            .attr("cx", function(d) { return xScale(d.Year); })		            .attr("cy", function(d) { return yScale(d.totalNumberOfAttacks); })		            .on("mouseover", function(d){		            	d3.selectAll(".circleNumberOfSuccessfulAttacks").style("opacity", "0.4");		            	d3.selectAll(".lineNumberOfSuccessfulAttacks").style("opacity", "0.3");		            	d3.selectAll(".circleNumberOfInternationalAttacks").style("opacity", "0.4");		            	d3.selectAll(".lineNumberOfInternationalAttacks").style("opacity", "0.3");						d3.select(this).attr("r", "6").attr("fill", "#fc9e4f");					}).on("mouseout", function(d){						d3.selectAll(".circleNumberOfSuccessfulAttacks").style("opacity", "1");		            	d3.selectAll(".lineNumberOfSuccessfulAttacks").style("opacity", "1");		            	d3.selectAll(".circleNumberOfInternationalAttacks").style("opacity", "1");		            	d3.selectAll(".lineNumberOfInternationalAttacks").style("opacity", "1");						d3.select(this).attr("r", "8").attr("fill", "transparent");					})					.on('mouseover.tip', tip1.show)					.on('mouseout.tip', tip1.hide)				    			svgLineChart.append("path")				.attr("class","lineNumberOfAttacks")				.attr("fill", "none")				.attr("stroke", "#fc9e4f")				.attr("stroke-width", 2)			 	.attr("opacity", "1")				.attr("d", valueline1(sumAttacks))				.on("mouseover", function(d){					d3.selectAll(".circleNumberOfSuccessfulAttacks").style("opacity", "0.4");	            	d3.selectAll(".lineNumberOfSuccessfulAttacks").style("opacity", "0.3");	            	d3.selectAll(".circleNumberOfInternationalAttacks").style("opacity", "0.4");	            	d3.selectAll(".lineNumberOfInternationalAttacks").style("opacity", "0.3");				}).on("mouseout", function(d){					d3.selectAll(".circleNumberOfSuccessfulAttacks").style("opacity", "1");	            	d3.selectAll(".lineNumberOfSuccessfulAttacks").style("opacity", "1");	            	d3.selectAll(".circleNumberOfInternationalAttacks").style("opacity", "1");	        	   	d3.selectAll(".lineNumberOfInternationalAttacks").style("opacity", "1");				})			var colorsAux = {				NumberOfAttacks: {				    hex: "#fc9e4f",				    name: "Total Attacks"				}			};			if(colors != null){				Object.assign(colors,colorsAux);			} else {				colors = colorsAux			}			updatelineChartLegend();		}		function createNumberOfSuccessfulAttacks(){			svgLineChart.selectAll(".circleNumberOfSuccessfulAttacks")				.data(sumSuccessfulAttacks)				.enter()				.append("circle")		        	.attr("class","circleNumberOfSuccessfulAttacks")			        .attr("fill", "transparent")			        .attr("r", "8")			        .attr("opacity", "1")		            .attr("cx", function(d) { return xScale(d.Year); })		            .attr("cy", function(d) { return yScale(d.totalSuccessfulAttacks); })		            .on("mouseover", function(d){						d3.selectAll(".circleNumberOfAttacks").style("opacity", "0.4");		            	d3.selectAll(".lineNumberOfAttacks").style("opacity", "0.3");		            	d3.selectAll(".circleNumberOfInternationalAttacks").style("opacity", "0.4");		            	d3.selectAll(".lineNumberOfInternationalAttacks").style("opacity", "0.3");						d3.select(this).attr("r", "6").attr("fill", "#fcc84f");					}).on("mouseout", function(d){						d3.selectAll(".circleNumberOfAttacks").style("opacity", "1");		            	d3.selectAll(".lineNumberOfAttacks").style("opacity", "1");		            	d3.selectAll(".circleNumberOfInternationalAttacks").style("opacity", "1");		            	d3.selectAll(".lineNumberOfInternationalAttacks").style("opacity", "1");		            	d3.select(this).attr("r", "8").attr("fill", "transparent");					})					.on('mouseover.tip', tip2.show)					.on('mouseout.tip', tip2.hide)				    			svgLineChart.append("path")				.attr("class","lineNumberOfSuccessfulAttacks")				.attr("fill", "none")				.attr("stroke", "#fcc84f")				.attr("stroke-width", 2)				.attr("opacity", "1")				.attr("d", valueline2(sumSuccessfulAttacks))				.on("mouseover", function(d){					d3.selectAll(".circleNumberOfAttacks").style("opacity", "0.4");	            	d3.selectAll(".lineNumberOfAttacks").style("opacity", "0.3");	            	d3.selectAll(".circleNumberOfInternationalAttacks").style("opacity", "0.4");	            	d3.selectAll(".lineNumberOfInternationalAttacks").style("opacity", "0.3");				}).on("mouseout", function(d){					d3.selectAll(".circleNumberOfAttacks").style("opacity", "1");	            	d3.selectAll(".lineNumberOfAttacks").style("opacity", "1");	            	d3.selectAll(".circleNumberOfInternationalAttacks").style("opacity", "1");	            	d3.selectAll(".lineNumberOfInternationalAttacks").style("opacity", "1");				})			var colorsAux = {				NumberOfSuccessfulAttacks: {				    hex: "#fcc84f",				    name: "Successful Attacks"				}			};			if(colors != null){				Object.assign(colors,colorsAux);			} else {				colors = colorsAux			}			updatelineChartLegend();		}		function createNumberOfInternationalAttacks(){			svgLineChart.selectAll(".circleNumberOfInternationalAttacks")				.data(sumInternationalAttacks)				.enter()				.append("circle")		        	.attr("class","circleNumberOfInternationalAttacks")			        .attr("fill", "transparent")			        .attr("r", "8")			        .attr("opacity", "1")		            .attr("cx", function(d) { return xScale(d.Year); })		            .attr("cy", function(d) { return yScale(d.totalInternationalAttacks); })		            .on("mouseover", function(d){						d3.selectAll(".circleNumberOfAttacks").style("opacity", "0.4");		            	d3.selectAll(".lineNumberOfAttacks").style("opacity", "0.3");		            	d3.selectAll(".circleNumberOfSuccessfulAttacks").style("opacity", "0.4");		            	d3.selectAll(".lineNumberOfSuccessfulAttacks").style("opacity", "0.3");						d3.select(this).attr("r", "6").attr("fill", "#fc724f");					}).on("mouseout", function(d){						d3.selectAll(".circleNumberOfAttacks").style("opacity", "1");		            	d3.selectAll(".lineNumberOfAttacks").style("opacity", "1");		            	d3.selectAll(".circleNumberOfSuccessfulAttacks").style("opacity", "1");		            	d3.selectAll(".lineNumberOfSuccessfulAttacks").style("opacity", "1");		            	d3.select(this).attr("r", "8").attr("fill", "transparent");					})					.on('mouseover.tip', tip3.show)					.on('mouseout.tip', tip3.hide)				    			svgLineChart.append("path")				.attr("class","lineNumberOfInternationalAttacks")				.attr("fill", "none")				.attr("stroke", "#fc724f")				.attr("stroke-width", 2)				.attr("opacity", "1")				.attr("d", valueline3(sumInternationalAttacks))				.on("mouseover", function(d){					d3.selectAll(".circleNumberOfAttacks").style("opacity", "0.4");	            	d3.selectAll(".lineNumberOfAttacks").style("opacity", "0.3");	            	d3.selectAll(".circleNumberOfSuccessfulAttacks").style("opacity", "0.4");	            	d3.selectAll(".lineNumberOfSuccessfulAttacks").style("opacity", "0.3");					}).on("mouseout", function(d){					d3.selectAll(".circleNumberOfAttacks").style("opacity", "1");	            	d3.selectAll(".lineNumberOfAttacks").style("opacity", "1");	            	d3.selectAll(".circleNumberOfSuccessfulAttacks").style("opacity", "1");	            	d3.selectAll(".lineNumberOfSuccessfulAttacks").style("opacity", "1");				})			var colorsAux = {				NumberOfInternationalAttacks: {				    hex: "#fc724f",				    name: "International Attacks"				}			};			if(colors != null){				Object.assign(colors,colorsAux);			} else {				colors = colorsAux			}			updatelineChartLegend();		}		function createbubbleChartLegend(){			bubbleChartLegend = svgBubbleChart.append("g")				.attr("class", "bubbleChartLegend")				.attr("transform", `translate(340, 5)`)				.style("font-size", "11px");		}		function updatebubbleChartLegend(){			if(bubbleChartLegend != null){				svgBubbleChart.select(".bubbleChartLegend").remove()			}			createbubbleChartLegend();			if(colors2 != null){				Object.keys(colors2).forEach((color, i) => {					bubbleChartLegend						.append("text")						.attr("y", `${i}em`)						.attr("x", "1em")						.text(colors2[color].name);					bubbleChartLegend						.append("circle")						.attr("cy", `${i - 0.25}em`)						.attr("cx", 0)						.attr("r", "0.4em")						.attr("fill", colors2[color].hex)						.attr("stroke", "black")						.style("opacity", "0.7");				});			}		}				function createSortedBubbleChart(checkbox4, checkbox5){			auxTotalNumberKilled = 0;			auxTotalNumberWounded = 0;			noAvailableAttacksLegend = false;			for(i = 0; i < sumExpenditureValue.length; i++){				bubbleChartData = new Array();				auxTotalNumberKilled += sumExpenditureValue[i].totalNumberKilled				auxTotalNumberWounded += sumExpenditureValue[i].totalNumberWounded				var totalNumberKilledValue = {					name: "totalNumberKilled",					value: wScale(sumExpenditureValue[i].totalNumberKilled)				}				bubbleChartData.push(totalNumberKilledValue)				var totalNumberWoundedValue = {					name: "totalNumberWounded",					value: vScale(sumExpenditureValue[i].totalNumberWounded)				}				bubbleChartData.push(totalNumberWoundedValue)				bubbleChartData.sort(function(a, b){return b.value-a.value});				for(j = 0; j < bubbleChartData.length; j++){					if(bubbleChartData[j].name=="totalNumberKilled" && checkbox4==true){						createBubbleChartToopltip(sumExpenditureValue[i].Year, sumExpenditureValue[i].totalExpenditure, sumExpenditureValue[i].totalNumberKilled)						svgBubbleChart.append("circle")								.attr("class","circleNumberOfKilledForExpenditureValue")								.style("fill", function(d) {									if(sumExpenditureValue[i].totalNumberKilled > 0){										return "#ba484a";									} else {										noAvailableAttacksLegend = true;										return "#D3D3D3";									} 								})							    .style("opacity", "0.7")							    .attr("stroke", "black")								.attr("cx", xScale(sumExpenditureValue[i].Year))						        .attr("cy", yScaleExpenditure(sumExpenditureValue[i].totalExpenditure))						        .attr("r", wScale(sumExpenditureValue[i].totalNumberKilled)+4)						        .on('mouseover.tip', tip5.show)								.on('mouseout.tip', tip5.hide)								.on("mouseover", function(d){									d3.select(this).style("opacity", "1");								}).on("mouseout", function(d){									d3.select(this).style("opacity", "0.7");								})					} else if(bubbleChartData[j].name=="totalNumberWounded" && checkbox5==true){						createBubbleChartToopltip2(sumExpenditureValue[i].Year, sumExpenditureValue[i].totalExpenditure, sumExpenditureValue[i].totalNumberWounded)						svgBubbleChart.append("circle")								.attr("class","circleNumberOfWoundedForExpenditureValue")		        				.style("fill", function(d) {									if(sumExpenditureValue[i].totalNumberWounded > 0){										return "#f28e2c";									} else {										noAvailableAttacksLegend = true;										return "#D3D3D3";									} 								})							    .style("opacity", "0.7")							    .attr("stroke", "black")								.attr("cx", xScale(sumExpenditureValue[i].Year))						        .attr("cy", yScaleExpenditure(sumExpenditureValue[i].totalExpenditure))						        .attr("r", vScale(sumExpenditureValue[i].totalNumberWounded)+4)						        .on('mouseover.tip', tip6.show)								.on('mouseout.tip', tip6.hide)								.on("mouseover", function(d){									d3.select(this).style("opacity", "1");								}).on("mouseout", function(d){									d3.select(this).style("opacity", "0.7");								})					}				}			}			if(checkbox4==true && auxTotalNumberKilled > 0){				var colorsAux = {					NumberOfKilled: {					    hex: "#9d0b0b",					    name: "No. of Killed"					}				};				if(colors2 != null){					Object.assign(colors2,colorsAux);				} else {					colors2 = colorsAux				}			}			if(checkbox5==true && auxTotalNumberWounded > 0){				var colorsAux = {					NumberOfWounded: {					    hex: "#eb8242",					    name: "No. of Wounded"					}				};				if(colors2 != null){					Object.assign(colors2,colorsAux);				} else {					colors2 = colorsAux				}			}			if(auxTotalNumberKilled == 0){				delete colors2["NumberOfKilled"]; 			}			if(auxTotalNumberWounded == 0){				delete colors2["NumberOfWounded"]; 			}			if(noAvailableAttacksLegend == true  && (checkbox4==true || checkbox5==true)){				Object.assign(colors2, {					NoAvailableAttacks: {					    hex: "#D3D3D3",					    name: "No Fatalities"					}				});			}			updatebubbleChartLegend();		}		function createWithVerifications(attacksDataset, createOrNotCreate){			var checkbox4 = false;			var checkbox5 = false;					/*d3.selectAll(".myCheckbox").each(function(d){	     		checkbox = d3.select(this);				if(checkbox.property("value") == "myCheckbox1" && checkbox.property("checked")==true){					svgLineChart.selectAll(".circleNumberOfAttacks").remove()					svgLineChart.selectAll(".lineNumberOfAttacks").remove()					createNumberOfAttacks();				}				if(checkbox.property("value") == "myCheckbox2" && checkbox.property("checked")==true){					svgLineChart.selectAll(".circleNumberOfSuccessfulAttacks").remove()					svgLineChart.selectAll(".lineNumberOfSuccessfulAttacks").remove()					createNumberOfSuccessfulAttacks();				}				if(checkbox.property("value") == "myCheckbox3" && checkbox.property("checked")==true){					svgLineChart.selectAll(".circleNumberOfInternationalAttacks").remove()					svgLineChart.selectAll(".lineNumberOfInternationalAttacks").remove()					createNumberOfInternationalAttacks();				}				if(checkbox.property("value") == "myCheckbox4" && checkbox.property("checked")==true){					checkbox4 = true				}				if(checkbox.property("value") == "myCheckbox5" && checkbox.property("checked")==true){					checkbox5 = true				}			})*/					svgLineChart.selectAll(".circleNumberOfAttacks").remove()					svgLineChart.selectAll(".lineNumberOfAttacks").remove()					createNumberOfAttacks();					svgLineChart.selectAll(".circleNumberOfSuccessfulAttacks").remove()					svgLineChart.selectAll(".lineNumberOfSuccessfulAttacks").remove()					createNumberOfSuccessfulAttacks();					svgLineChart.selectAll(".circleNumberOfInternationalAttacks").remove()					svgLineChart.selectAll(".lineNumberOfInternationalAttacks").remove()					createNumberOfInternationalAttacks();			delete colors2.NoAvailableAttacks			svgBubbleChart.selectAll(".circleNumberOfAttacksForExpenditureValue").remove()			svgBubbleChart.selectAll(".circleNumberOfKilledForExpenditureValue").remove()			svgBubbleChart.selectAll(".circleNumberOfWoundedForExpenditureValue").remove()			createSortedBubbleChart(checkbox4, checkbox5)			//readDataToFillRadarChart(attacksDataset,"create");			//readDataToFillWordcloud(attacksDataset);		}		function createSlider(attacksDataset){			sliderRange = d3.sliderBottom()				.width(650)				.min(d3.min(availableYears))				.max(d3.max(availableYears))				.default([1990,2018])				.ticks(10)				.tickFormat(d3.format('.0f'))				.fill('#328849')				.handle(					d3.symbol()				        .type(d3.symbolCircle)				        .size(200)()			    )				.on('onchange', val => {					minYearAux = minYear					minYear = parseDate(val.map(d3.format('.0f'))[0]);					maxYear = parseDate(val.map(d3.format('.0f'))[1]);					updateGeoJson(attacksDataset);					readDataset(attacksDataset, savedExpenditureDataset);					createWithVerifications(attacksDataset);					readDataBarChart(attacksDataset);					drawSankey(attacksDataset);				});			var gRange = d3.select('div#sliderRange')				.append('svg')				.attr('width', 700)				.attr('height', 70)				.append('g')				.attr('transform', 'translate(25, 19)');			gRange.call(sliderRange);		}			function createCheckboxes(attacksDataset){			d3.selectAll(".myCheckbox").on("change", function update(){				var checkbox4 = false;				var checkbox5 = false;				d3.selectAll(".myCheckbox").each(function(d){	         		checkbox = d3.select(this);					if(checkbox.property("value") == "myCheckbox1" && checkbox.property("checked")==true){						svgLineChart.selectAll(".circleNumberOfAttacks").remove()						svgLineChart.selectAll(".lineNumberOfAttacks").remove()						createNumberOfAttacks();					}					if(checkbox.property("value") == "myCheckbox1" && checkbox.property("checked")==false){						svgLineChart.selectAll(".circleNumberOfAttacks").remove()						svgLineChart.selectAll(".lineNumberOfAttacks").remove()						delete colors.NumberOfAttacks						updatelineChartLegend();					}					if(checkbox.property("value") == "myCheckbox2" && checkbox.property("checked")==true){						svgLineChart.selectAll(".circleNumberOfSuccessfulAttacks").remove()						svgLineChart.selectAll(".lineNumberOfSuccessfulAttacks").remove()						createNumberOfSuccessfulAttacks();					}					if(checkbox.property("value") == "myCheckbox2" && checkbox.property("checked")==false){						svgLineChart.selectAll(".circleNumberOfSuccessfulAttacks").remove()						svgLineChart.selectAll(".lineNumberOfSuccessfulAttacks").remove()						delete colors.NumberOfSuccessfulAttacks						updatelineChartLegend();					}					if(checkbox.property("value") == "myCheckbox3" && checkbox.property("checked")==true){						svgLineChart.selectAll(".circleNumberOfInternationalAttacks").remove()						svgLineChart.selectAll(".lineNumberOfInternationalAttacks").remove()						createNumberOfInternationalAttacks();					}					if(checkbox.property("value") == "myCheckbox3" && checkbox.property("checked")==false){						svgLineChart.selectAll(".circleNumberOfInternationalAttacks").remove()						svgLineChart.selectAll(".lineNumberOfInternationalAttacks").remove()						delete colors.NumberOfInternationalAttacks						updatelineChartLegend();					}					if(checkbox.property("value") == "myCheckbox4" && checkbox.property("checked")==false){						svgBubbleChart.selectAll(".circleNumberOfKilledForExpenditureValue").remove()						delete colors2.NumberOfKilled						updatebubbleChartLegend();					}					if(checkbox.property("value") == "myCheckbox4" && checkbox.property("checked")==true){						checkbox4 = true					}					if(checkbox.property("value") == "myCheckbox5" && checkbox.property("checked")==false){						svgBubbleChart.selectAll(".circleNumberOfWoundedForExpenditureValue").remove()						delete colors2.NumberOfWounded						updatebubbleChartLegend();					}					if(checkbox.property("value") == "myCheckbox5" && checkbox.property("checked")==true){						checkbox5 = true					}				})				svgBubbleChart.selectAll(".circleNumberOfKilledForExpenditureValue").remove()				svgBubbleChart.selectAll(".circleNumberOfWoundedForExpenditureValue").remove()				createSortedBubbleChart(checkbox4, checkbox5)			})		}		function createSelection(attacksDataset){			d3.select(".countrySelection").on("change", function update(){						selectedCountry = d3.select(".countrySelection").property("value")				updateAllSelections(attacksDataset);				svgGeoMap.selectAll("path")					.style("stroke-width", "0.4")				if(selectedCountry == "European Union"){					selectCountryTxt = "EU"				}else{					selectCountryTxt = selectedCountry				}				if(selectedCountry == "United Kingdom"){					svgGeoMap.selectAll("path#UnitedKingdom")						.style("stroke-width", "1.4")				}else if(selectedCountry == "Czech Republic"){					svgGeoMap.select("path#CzechRepublic")						.style("stroke-width", "1.4")				}else if(selectedCountry == "Slovak Republic"){					svgGeoMap.select("path#SlovakRepublic")						.style("stroke-width", "1.4")				}else{					svgGeoMap.select("path#"+selectedCountry)						.style("stroke-width", "1.4")  				}  				svgLineChart.selectAll("text#yAxis")					.text("Attacks in " + selectCountryTxt)					svgBubbleChart.selectAll("text#yAxis")					.text("Military Expenditure in " + selectCountryTxt)			})			d3.select(".attackTypeSelection").on("change", function update(){						selectedAttackType = d3.select(".attackTypeSelection").property("value")				selectedBooleanAttackType = true;				updateAllSelections(attacksDataset);			})			d3.select(".targetTypeSelection").on("change", function update(){				selectedTargetType = d3.select(".targetTypeSelection").property("value")				selectedBooleanTargetType = true;				updateAllSelections(attacksDataset);			})        }        function createClearButton(attacksDataset){			d3.select(".clearButton").on("click", function update(){				sliderRange.value([1990, 2018])				minYear = parseDate(1990)				maxYear = parseDate(2018)				selectedCountry = "European Union"				selectedAttackType = "No Attack Type"				selectedTargetType = "No Target Type"				d3.select(".countrySelection").property('value', selectedCountry)				d3.select(".countrySelection").dispatch("change")				d3.selectAll(".myCheckbox").each(function(d){	     			checkbox = d3.select(this);	     			checkbox.property("checked", true);				})								updateAllSelections(attacksDataset);								d3.selectAll(".Country").style("opacity", "1");			})        }        function updateAllSelections(attacksDataset){			readDataset(attacksDataset, savedExpenditureDataset);			updateGeoJson(attacksDataset);			createWithVerifications(attacksDataset);			drawSankey(attacksDataset);			readDataBarChart(attacksDataset);		}		function readDataSankey(data){			var years = d3.range(minYear.getFullYear(), maxYear.getFullYear() + 1)			var attacksFromThatYear = null			if(selectedCountry == "European Union"){				attacksFromThatYear = data.filter(function (d){					return (years.includes(d.Year.getFullYear()));				});			}else{				attacksFromThatYear = data.filter(function (d){					return (years.includes(d.Year.getFullYear()) && (d.country === selectedCountry.trim()));				});			}			if(selectedAttackType != "No Attack Type"){				attacksFromThatYear = attacksFromThatYear.filter(function (d){					return ((d.attackType == selectedAttackType));				});			}						      targetAndSubTargetAttacks = new Array()		      uniqueTargetType = d3.map(data, function(d){return d.targetType;}).keys()		      for(i =0 ; i < uniqueTargetType.length; i++){		        attacksFromThatTargetType = attacksFromThatYear.filter(function (d){		          return (d.targetType == uniqueTargetType[i]);		        });				uniqueTargetSubtype = d3.map(attacksFromThatTargetType, function(d){return d.targetSubtype;}).keys()				for(j =0 ; j < uniqueTargetSubtype.length; j++){					attacksFromThatSubTargetType = attacksFromThatTargetType.filter(function (d){						return (d.targetSubtype == uniqueTargetSubtype[j]);					});				 	attacksCount = attacksFromThatSubTargetType.length				    if(uniqueTargetSubtype[j] != "Unknown" && attacksCount >= 5){						var newValue = {													targetType: (uniqueTargetType[i]).trim(),					        targetSubtype: (uniqueTargetSubtype[j]).trim(),					        numberOfAttacks: attacksCount				     	}				       					       	targetAndSubTargetAttacks.push(newValue)					} 				}			}						//console.log(targetAndSubTargetAttacksWithTitle);			allNodes = targetAndSubTargetAttacks			sortallNodes(allNodes);			allNodes.splice(5, (allNodes.length - 5));			console.log(allNodes);			return allNodes;		}		function sortallNodes(allNodes){		  //order values for graph links		  allNodes.sort(function(a, b) {		  return b.numberOfAttacks - a.numberOfAttacks;		   });		}		function drawSankey(data){		  nodeUserinLinksSankey = [];		  updateSankey();		  readDataSankey(data);		  //set up graph in same style as original example but empty		  graph = {"nodes" : [], "links" : []};		  var keys = Object.keys(allNodes[0]); //get the headers for the data		  //keys.splice(keys.indexOf('country'), 5)//remove the IDs key		  keys.splice(keys.indexOf('numberOfAttacks'))//remove the IDs key		    allNodes.forEach(function(d){		      keys.forEach(function (key, i){		        graph.links.splice(5, (graph.links.length - 5));		        if (d[key]!="undefined") { adduniquenodes(d[key]); } //add node if not "none"		        var c = 1; //checks next column		        if (d[keys[i+c]]!= undefined && d[key] !== "undefined"){		          while (d[keys[i+c]] === "undefined" ){		            c = c+1;     //jump to next column if "none" found in the column next		           }		            graph.links.push ({		              "source" :  d[key],		              "target" :  d[keys[i+c]],		              "value" : countvalues(key,d[key],keys[i+c],d[keys[i+c]]) 		            });		        };		      })		    });		  //order values for graph links		  graph.links.sort(function(a, b) {		  return b.value - a.value;		   });		  getnodeUserinLinksSankey(graph.links);		  graph.nodes = nodeUserinLinksSankey; 		  function getnodeUserinLinksSankey(value){		    i=0;		    for (i in graph.links){		        nodeUserinLinksSankey.push( graph.links[i].source);		        nodeUserinLinksSankey.push( graph.links[i].target);		    };		  };		  function onlyUnique(value, index, self) { 		      return self.indexOf(value) === index;		  }		  let uniqueNodes = [...new Set(graph.nodes)];		  //console.log(uniqueNodes);		  graph.nodes = uniqueNodes;		    function adduniquenodes(value) {		      if (graph.nodes.indexOf(value) === -1 ){		        graph.nodes.push(value);		      }		    }		  		    function countvalues (sourcekey, source, targetkey, target) {		      var c = 0;		      data.forEach (function (d){		        if (d[sourcekey] === source && d[targetkey]===target){		          c++;		        }		      });		      return c;		    }		     // loop through each link replacing the text with its index from node		     graph.links.forEach(function (d, i) {		       graph.links[i].source = graph.nodes.indexOf(graph.links[i].source);		       graph.links[i].target = graph.nodes.indexOf(graph.links[i].target);		     });		      		     //now loop through each nodes to make nodes an array of objects		     // rather than an array of strings		     graph.nodes.forEach(function (d, i) {		       graph.nodes[i] = { "name": d };		     });		  sankey		    .nodes(graph.nodes)		    .links(graph.links)		    .layout(32);		// // add in the links		  var link = svgSankey.append("g").selectAll(".link")		      .data(graph.links)		      .attr("class","sankeyRedraw")		    .enter().append("path")		      .attr("class", "link")		      .attr("d", pathSankey)		      .style("stroke-width", function(d) { return Math.max(1, d.dy); })		      .sort(function(a, b) { return b.dy - a.dy; });		 // add the link titles		  link.append("title")				.attr("class","sankeyRedraw")		        .text(function(d) {		        return d.source.name + " ‚Üí " + 		                d.target.name + "\n" + format(d.value); });		// add in the nodes		  var node = svgSankey.append("g").selectAll(".node")		      .data(graph.nodes)		      .attr("class","sankeyRedraw")		    .enter().append("g")		      .attr("class", "node")		      .attr("transform", function(d) { 		      return "translate(" + d.x + "," + d.y + ")"; })		 /*   .call(d3.drag()		      .subject(function(d) { return d; })		      .on("start", function() { 		      this.parentNode.appendChild(this); }) )*/;		    //  .on("drag", dragmove));		// add the rectangles for the nodes		  node.append("rect")	  		.on('mouseenter', function (d) {		        d3.select(this)		          .attr('opacity', 0.6)		      })			.on('mouseleave', function (d) {		        d3.select(this)		          .attr('opacity', 1)		      })			  .on('mouseover.tip', tip8.show)			  .on('mouseout.tip', tip8.hide)		 	  .attr("class","sankeyRedraw")		      .attr("height", function(d) { return d.dy; })		      .on("click", clickedNodes)		      .attr("width", sankey.nodeWidth())		      .style('fill',function(d) { return colorSankey(d.value); })		      //.style("fill", function(d) { 		      //return d.color = color(d.name.replace(/ .*/, "")); })		      .style("stroke", function(d) { 		      return d3.rgb(d.color).darker(2); });		// add in the title for the nodes		  node.append("text")		  	  .attr("class","sankeyRedraw")		      .attr("x", -6)		      .attr("y", function(d) { return d.dy / 2; })		      .attr("dy", ".35em")		      .attr("text-anchor", "end")		      .style("fill", "white")		      .attr("transform", null)		      .text(function(d) { return d.name; })		    .filter(function(d) { return d.x < widthSankey / 2; })		      .attr("x", 6 + sankey.nodeWidth())		      .attr("text-anchor", "start");		d3.selectAll(".targetTypeSelection").selectAll("option").remove()		d3.select(".targetTypeSelection").append("option")				.attr("value", "No Target Type")                .text("No Target Type");        SankeyNames = new Array();		for(i =0 ; i < graph.nodes.length; i++){			SankeyNames.push(graph.nodes[i].name)		    d3.select(".targetTypeSelection").append("option")				.attr("value", graph.nodes[i].name)            	.text(graph.nodes[i].name);        }        if(selectedTargetType != "No Attack Type"){        	if(SankeyNames.includes(selectedTargetType)==true){				d3.select(".targetTypeSelection").property("value", selectedTargetType)        	} else {				d3.select(".targetTypeSelection").append("option")					.attr("value", selectedTargetType)                	.text(selectedTargetType)                	.property("selected", selectedTargetType);            }        }		   //the function for moving the nodes		  function dragmove(d) {		    d3.select(this).attr("transform", 		        "translate(" + d.x + "," + (		                d.y = Math.max(0, Math.min(heightSankey - d.dy, d3.event.y))		            ) + ")");		    sankey.relayout();		    link.attr("d", pathSankey);		  }	};	function updateSankey(){			svgSankey.selectAll("g > *").remove();		}	function clickedNodes(c, i) {			 selectedTargetType = c.name			 console.log(selectTargetType);			d3.select(".targetTypeSelection").property('value', selectedTargetType)			d3.select(".targetTypeSelection").dispatch("change")			    if( d3.select(this).attr("data-clicked") == "1" ){			      d3.select(this).attr("data-clicked","0");			      stroke_opacity = 0.2;			    }else{			      d3.select(this).attr("data-clicked","1");			      stroke_opacity = 0.5;			    }		}	 function readDataBarChart(attacksDataset){	 	svgBar.selectAll("g > *").remove();		var years = d3.range(minYear.getFullYear(), maxYear.getFullYear() + 1);		barData = new Array();		var attacksFromThatYear = null;		if(selectedCountry == "European Union"){			attacksFromThatYear = attacksDataset.filter(function (d){				return (years.includes(d.Year.getFullYear()));			});		}else{			attacksFromThatYear = attacksDataset.filter(function (d){				return (years.includes(d.Year.getFullYear()) && ((d.country).trim() === selectedCountry.trim()));			});		}		if(selectedTargetType != "No Target Type"){			attacksFromThatYearAux = attacksFromThatYear.filter(function (d){				return ((d.targetType == selectedTargetType));			});			if(attacksFromThatYearAux.length == 0){				attacksFromThatYear = attacksFromThatYear.filter(function (d){					return ((d.targetSubtype == selectedTargetType));				});			} else {				attacksFromThatYear = attacksFromThatYearAux;			}		}		for(i =0 ; i < attackTypes.length; i++){		    attacksFromThatType = attacksFromThatYear.filter(function (d){					return (d.attackType == attackTypes[i]);			});		    if(attacksFromThatType.length > 0){				var newValue = {					name: attackTypes[i],					totalAttacks: attacksFromThatType.length,				}				barData.push(newValue)			}		}		/*attack Selection box*/		d3.selectAll(".attackTypeSelection").selectAll("option").remove()		d3.select(".attackTypeSelection").append("option")				.attr("value", "No Attack Type")            	.text("No Attack Type");        barNames = new Array();		for(i =0 ; i < barData.length; i++){			barNames.push(barData[i].name)		    d3.select(".attackTypeSelection").append("option")				.attr("value", barData[i].name)            	.text(barData[i].name);        }        if(selectedAttackType != "No Attack Type"){        	if(barNames.includes(selectedAttackType)==true){				d3.select(".attackTypeSelection").property("value", selectedAttackType)        	} else {				d3.select(".attackTypeSelection").append("option")					.attr("value", selectedAttackType)                	.text(selectedAttackType)                	.property("selected", selectedAttackType);            }        }		drawHbar(barData);		var max = d3.max(barData, function(d) {return d.totalAttacks;})	 }    function clickedBar(c, i) {		 selectedAttackType = c.name			d3.select(".attackTypeSelection").property('value', selectedAttackType)			d3.select(".attackTypeSelection").dispatch("change")		}	function drawHbar(barData){		var max = d3.max(barData, function(d) {return d.totalAttacks;}) 		const xScale = d3.scaleLinear()		    .range([heightBar, 0])		    .domain([max, 0]);		 const yScale = d3.scaleBand()		    .range([0, widthBar])		    .domain(barData.map((s) => s.name))		    .padding(0.2);		 svgBar.append('g')		    .call(d3.axisLeft(yScale))		    .style("color", "white")		    .style("font-family", "Times New Roman")		    .style("font-size", 14);		svgBar.append('g')		    .attr('transform', `translate(0, ${widthBar})`)		    .call(d3.axisBottom(xScale))		    .style("color", "white")		    .style("font-family", "Times New Roman")		    .style("font-size", 14);		 /*Draw bars*/		svgBar.selectAll()		    .data(barData)		    .enter()		    .append('rect')		    .attr('y', (s) => yScale(s.name))		   // .attr('x', (s) => xScale(s.totalAttacks))		    .attr('width', (s) => xScale(s.totalAttacks))		    .attr('height', yScale.bandwidth())			.attr('fill',function(d) { return colorBar(d.totalAttacks); })		    .style("opacity", 0.6)		    .on('mouseover.tip', tip7.show)			.on('mouseout.tip', tip7.hide)			.on("mouseover", function(d){				d3.select(this).style("opacity", "1");			}).on("mouseout", function(d){					d3.select(this).style("opacity", "0.6");			})					    .on("click", clickedBar)		 /*Text*/	/*	svgBar.append('text')			.attr("class","barChartRedraw")			.attr("id", "yScaleBar")  		    .attr('x', -(heightBar / 3.2) )		    .attr('y', marginBar - (marginBar +140))		    .attr('transform', 'rotate(-90)')		    .style("font-size", "16px")		    .style("fill", "white")		    .style("font-family", "Times New Roman")		    .attr('text-anchor', 'middle')		    .text('AttackTypes') */	    svgBar.append('text')	   	  .attr("class","barChartRedraw")	      .attr('class', 'label')	      .attr('x', widthBar / 1.2 )	      .attr('y', heightBar - 135 )	      .style("font-size", "16px")	      .style("fill", "white")	      .style("font-family", "Times New Roman")	      .attr('text-anchor', 'middle')	      .text('Total Attacks')		    	}	</script>	</body></html>